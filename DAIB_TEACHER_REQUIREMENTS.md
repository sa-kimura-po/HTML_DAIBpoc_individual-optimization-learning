# DAIB個別最適化学習システム - 教員用UI機能・要件書

## 概要
同志社大学DAIBシステムに追加する個別最適化学習機能の教員用インターフェース仕様書

## システム構成

### 1. 基本UI構造
- **レイアウト**: 左サイドバー + メインコンテンツエリア
- **デザインシステム**: DAIB統一デザイン（学生用と共通）
- **レスポンシブ対応**: デスクトップ・タブレット対応

### 2. 左サイドバー構成

#### 2.1 ヘッダー部
- **DAIBロゴ**: クリックでダッシュボードに戻る
- **ユーザー識別**: 「DAIB 教員」表示

#### 2.2 メニュー切り替えボタン
- **DAIB学習**: 新機能（コンテンツ管理・問題作成）
- **授業振り返り**: 従来機能（分析・管理）
- **状態管理**: トグル形式で排他選択

## 3. DAIB学習機能

### 3.1 講義資料・動画アップロード
#### 機能概要
- **目的**: PowerAppsファイル・動画ファイルの管理
- **対応形式**: PPTX, PDF, MP4, MOV等
- **連携**: 後続のキーワード抽出・問題生成に使用

#### 機能詳細
- **ドラッグ&ドロップアップロード**: 直感的なファイル追加
- **ファイル一覧表示**: アップロード済みファイルの管理
- **メタデータ管理**: ファイル名、アップロード日時、サイズ
- **削除機能**: 不要ファイルの除去
- **プレビュー機能**: ファイル内容の確認

#### データ保存
- **バックエンド**: CosmosDB（本実装）
- **フロントエンド**: モック表示

### 3.2 キーワード解説
#### 機能概要
- **目的**: 授業資料・動画・電子教科書からキーワード自動抽出
- **AI活用**: 自然言語処理によるキーワード特定
- **管理機能**: 抽出結果の編集・承認

#### 機能詳細
- **自動抽出**: アップロード素材からキーワード生成
- **キーワード一覧**: グリッド表示でキーワード管理
- **詳細編集**: 各キーワードの説明文編集
- **カテゴリ分類**: 授業回別・分野別分類
- **承認ワークフロー**: 教員による内容確認・承認

#### データ構造
```json
{
  "keyword_id": "string",
  "keyword": "string",
  "description": "string", 
  "category": "string",
  "lecture_week": "number",
  "approved": "boolean",
  "created_at": "datetime"
}
```

### 3.3 設問作成
#### 機能概要
- **目的**: 抽出キーワードを基にした問題自動生成
- **問題タイプ**: 穴埋め式、選択式、自由記述式、計算問題
- **学生連携**: 生成問題を学生の個別学習に提供

#### 機能詳細
- **生成設定**: 問題タイプ・難易度・問題数指定
- **AI生成**: キーワードベースの問題自動作成
- **問題管理**: 生成問題の一覧・編集・削除
- **承認システム**: 教員による問題品質確認
- **プレビュー機能**: 学生画面での表示確認

#### 問題データ構造
```json
{
  "problem_id": "string",
  "title": "string",
  "description": "string",
  "type": "calculation|choice|fill|essay",
  "difficulty": "basic|standard|advanced",
  "keywords": ["string"],
  "options": ["string"], // 選択問題の場合
  "correct_answer": "string",
  "explanation": "string",
  "approved": "boolean",
  "created_at": "datetime"
}
```

### 3.4 動画検索
#### 機能概要
- **目的**: 講義動画のキーワード検索・視聴
- **検索対象**: アップロード済み動画ファイル
- **AI活用**: 動画内容の自動インデックス化

#### 機能詳細
- **キーワード検索**: 動画内容からマッチング
- **検索結果表示**: サムネイル・タイトル・時間表示
- **マッチ箇所表示**: キーワード該当時間の表示
- **動画再生**: 埋め込みプレイヤーでの視聴
- **ブックマーク**: 重要箇所のマーク機能

## 4. 授業振り返り機能

### 4.1 教員ダッシュボード
#### 機能概要
- **目的**: 学生の学習状況統合管理
- **データ源**: 学生アンケート・問題回答結果
- **AI分析**: 学習状況の自動評価・提案

#### タブ構成 (5つのタブ)
1. **概要**: 全体的な学習状況と4つのトレンドグラフ
2. **キーワード理解度分析**: 理解度ヒートマップ
3. **学生管理**: 個別学生の進捗管理
4. **第7回講義分析**: 講義別統計と改善提案
5. **最終相関分析**: 学習指標の相関分析と期末試験成績予測

#### 概要タブ機能詳細
- **AI総合評価**: 全体的な学習状況の自動分析
- **統計カード**: 受講者数・平均理解度・アンケート提出率・要注意学生数
- **4つのトレンドグラフ**: 
  - アンケート提出率推移
  - アンケート理解度推移
  - 個別問題回答率推移
  - 個別問題正答率推移
- **キーワード別理解度**: 第7回講義のキーワード理解度一覧
- **レポート生成**: 学習状況レポートのエクスポート

#### 最終相関分析タブ機能詳細
- **学習指標相関マトリックス**: 5×5のヒートマップ表示
  - アンケート提出率、アンケート理解度、個別問題回答率、個別問題正答率、期末試験成績
- **期末試験成績との相関分析**: 実際の成績データを使った事後分析
- **学習パターン分析**: 学習行動の可視化
- **成績予測モデル**: 期末試験成績の予測分析

#### データ可視化
- **Chart.js使用**: キーワード理解度の棒グラフ、トレンドグラフ
- **相関ヒートマップ**: 学習指標間の相関係数可視化
- **レスポンシブ対応**: 画面サイズに応じた表示調整
- **インタラクティブ**: クリックでドリルダウン

### 4.2 授業回キーワード管理
#### 機能概要
- **目的**: 既存のキーワード管理機能
- **連携**: oldフォルダの既存HTMLとの統合
- **アクセス**: 詳細管理画面への遷移

#### 実装方針
- **現状維持**: 既存機能をそのまま活用
- **新画面連携**: 新UIから既存画面へのリンク
- **データ連携**: 新機能で生成されたキーワードとの統合

### 4.3 授業テーマ設定
#### 機能概要
- **目的**: 既存のテーマ設定機能
- **連携**: oldフォルダの既存HTMLとの統合
- **アクセス**: 詳細設定画面への遷移

#### 実装方針
- **現状維持**: 既存機能をそのまま活用
- **新画面連携**: 新UIから既存画面へのリンク
- **設定反映**: 新機能への設定値の適用

## 5. 状態管理システム

### 5.1 TEACHER_STATE
```javascript
const TEACHER_STATE = {
  currentMode: 'review', // 'daib' or 'review'
  currentDAIBFunction: 'upload',
  currentReviewFunction: 'dashboard',
  setMode: function(mode, func),
  updateUI: function(),
  updateNavigation: function()
}
```

### 5.2 UI制御
- **メニュー切り替え**: トグルボタンでモード変更
- **コンテンツ表示**: 選択機能に応じた画面表示
- **ナビゲーション**: アクティブ状態の視覚化

## 6. バックエンド連携仕様

### 6.1 ファイル管理API
```
POST /api/files/upload
GET /api/files/list
DELETE /api/files/{file_id}
```

### 6.2 キーワード管理API
```
POST /api/keywords/extract
GET /api/keywords/list
PUT /api/keywords/{keyword_id}
DELETE /api/keywords/{keyword_id}
```

### 6.3 問題管理API
```
POST /api/problems/generate
GET /api/problems/list
PUT /api/problems/{problem_id}
DELETE /api/problems/{problem_id}
POST /api/problems/{problem_id}/approve
```

### 6.4 学習分析API
```
GET /api/analytics/dashboard
GET /api/analytics/students
GET /api/analytics/keywords
POST /api/reports/generate
```

## 7. セキュリティ要件

### 7.1 認証・認可
- **教員認証**: 教員権限の確認
- **セッション管理**: セキュアなセッション維持
- **アクセス制御**: 教員機能への適切な制限

### 7.2 データ保護
- **ファイル暗号化**: アップロードファイルの暗号化
- **個人情報保護**: 学生データの適切な管理
- **ログ管理**: アクセス・操作ログの記録

## 8. パフォーマンス要件

### 8.1 応答性
- **ファイルアップロード**: 進捗表示・非同期処理
- **キーワード抽出**: バックグラウンド処理
- **問題生成**: 処理状況の表示
- **分析表示**: 1秒以内の描画

### 8.2 スケーラビリティ
- **同時接続**: 100教員の同時利用
- **ファイルサイズ**: 1ファイル最大100MB
- **データベース**: 効率的なクエリ設計

## 9. 運用要件

### 9.1 監視・メンテナンス
- **システム監視**: 稼働状況・エラー監視
- **データバックアップ**: 定期的なデータ保護
- **更新管理**: 機能追加・バグ修正の展開

### 9.2 サポート
- **ユーザーガイド**: 機能説明・操作手順
- **ヘルプデスク**: 教員からの問い合わせ対応
- **研修**: システム利用方法の教育

## 10. 実装状況（2025年7月16日現在）

### 10.1 完成済み機能
- ✅ **基本UI構造**: 左サイドバー + メインコンテンツエリア
- ✅ **メニュー切り替え**: DAIB学習 ⇔ 授業振り返り
- ✅ **DAIB学習メニュー**: 講義資料アップロード、DAIBチャット、科目別チャット
- ✅ **授業振り返りメニュー**: ダッシュボード、キーワード管理、テーマ設定
- ✅ **キーワード管理機能**: 完全統合（`old/keywords.html`からの移植）
- ✅ **テーマ設定機能**: 完全統合（`old/themes.html`からの移植）
- ✅ **チャットインターフェース**: 汎用・データサイエンス基礎・データサイエンス概論
- ✅ **右サイドメニュー**: キーワード解説、問題作成、動画検索
- ✅ **状態管理**: TEACHER_STATE オブジェクトによる統一管理
- ✅ **エラー修正**: JavaScript null参照エラーの修正完了

### 10.2 技術実装詳細

#### HTML構造
```
teacher/dashboard.html (統合版)
├── 左サイドバー
│   ├── メニュー切り替えボタン
│   ├── DAIB学習メニュー
│   └── 授業振り返りメニュー
├── メインコンテンツエリア
│   ├── DAIB-area (DAIB学習コンテンツ)
│   │   ├── チャットエリア (3列レイアウト)
│   │   └── アップロードコンテンツ
│   └── Review-area (授業振り返りコンテンツ)
│       ├── ダッシュボード
│       ├── キーワード管理
│       └── テーマ設定
```

#### JavaScript状態管理
```javascript
TEACHER_STATE = {
    currentMode: 'review', // 'daib' or 'review'
    currentDAIBFunction: 'upload',
    currentReviewFunction: 'dashboard',
    currentChatType: 'general',
    setMode: function(mode, func) { /* 状態切り替え */ },
    updateUI: function() { /* UI更新 */ },
    showDAIBContent: function() { /* DAIB表示制御 */ },
    showReviewContent: function() { /* 振り返り表示制御 */ }
}
```

#### エラー修正内容
- **null参照エラー修正**: DOM要素の存在チェック追加
- **デバッグ機能強化**: 詳細なコンソールログ出力
- **要素不存在対応**: 警告表示で処理継続

### 10.3 ファイル構成
```
teacher/
├── dashboard.html (統合メインファイル)
└── old/ (参考用旧ファイル)
    ├── keywords.html
    └── themes.html
```

### 10.4 今後の実装予定

#### Phase 2: バックエンド統合
- **ファイルアップロード**: Azure Storage連携
- **キーワード抽出**: Azure OpenAI Service統合
- **問題生成**: GPT-4による自動生成
- **データ永続化**: CosmosDB統合

#### Phase 3: 高度機能
- **リアルタイム分析**: 学習進捗の可視化
- **レポート生成**: PDF出力機能
- **通知システム**: 学生・教員への自動通知

### 10.5 デバッグ・テスト情報
- **コンソールログ**: 各関数で詳細なデバッグ情報出力
- **エラーハンドリング**: 要素不存在時の適切な処理
- **ブラウザテスト**: F12開発者ツールでのリアルタイム確認可能