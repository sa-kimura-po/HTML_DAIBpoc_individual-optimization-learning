<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DAIB 教員 - 個別最適化学習システム</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../common/daib-style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="daib-container">
        <div class="daib-main">
            <!-- 左サイドバー -->
            <div class="daib-sidebar">
                <!-- DAIBヘッダー -->
                <div class="daib-sidebar-header">
                    <div class="daib-header">
                        <a href="dashboard.html">DAIB 教員</a>
                    </div>
                </div>

                <!-- メニュー切り替えボタン -->
                <div class="daib-nav-section">
                    <div style="background: var(--daib-surface); padding: 8px; border-bottom: 1px solid var(--daib-border);">
                        <div class="menu-toggle-buttons">
                            <button id="daib-learning-toggle" class="menu-toggle-btn" onclick="toggleMenuMode('learning')">
                                DAIB学習
                            </button>
                            <button id="learning-review-toggle" class="menu-toggle-btn active" onclick="toggleMenuMode('review')">
                                授業振り返り
                            </button>
                        </div>
                    </div>
                </div>

                <!-- DAIB学習メニュー -->
                <div id="daib-learning-menu" class="menu-content">
                    <!-- DAIB学習セクション -->
                    <div class="daib-nav-section">
                        <div class="daib-nav-content" style="display: block; max-height: none; padding: 8px 16px 16px 16px; background: var(--daib-sidebar);">
                            <a href="#" class="nav-item" onclick="TEACHER_STATE.setMode('daib', 'upload')">
                                <i class="fas fa-upload"></i>
                                講義資料・動画アップロード
                            </a>
                            <a href="#" class="nav-item" onclick="TEACHER_STATE.setMode('chat', 'general')">
                                <i class="fas fa-comments"></i>
                                DAIBチャット
                            </a>
                            <a href="#" class="nav-item" onclick="TEACHER_STATE.setMode('chat', 'data-science')">
                                <i class="fas fa-chart-bar"></i>
                                データサイエンス基礎
                            </a>
                            <a href="#" class="nav-item" onclick="TEACHER_STATE.setMode('chat', 'data-overview')">
                                <i class="fas fa-database"></i>
                                データサイエンス概論
                            </a>
                        </div>
                    </div>
                </div>

                <!-- 授業振り返りメニュー -->
                <div id="learning-review-menu" class="menu-content active">
                    <div class="daib-nav-section" style="flex: 1; display: flex; flex-direction: column;">
                        <div class="daib-nav-content" style="display: block; max-height: none; padding: 8px 16px 16px 16px; background: var(--daib-sidebar); flex: 1;">
                            <a href="#" class="nav-item active" onclick="TEACHER_STATE.setMode('review', 'dashboard')">
                                <i class="fas fa-chart-line"></i>
                                教員ダッシュボード
                            </a>
                            <a href="#" class="nav-item" onclick="TEACHER_STATE.setMode('review', 'keyword-management')">
                                <i class="fas fa-tags"></i>
                                授業回キーワード管理
                            </a>
                            <a href="#" class="nav-item" onclick="TEACHER_STATE.setMode('review', 'theme-setting')">
                                <i class="fas fa-brain"></i>
                                授業テーマ設定
                            </a>
                            <a href="#" class="nav-item" onclick="TEACHER_STATE.setMode('review', 'problem-generation')">
                                <i class="fas fa-edit"></i>
                                個別問題生成
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- メインコンテンツエリア -->
            <div class="daib-content">
                <!-- DAIB学習コンテンツ -->
                <div id="daib-area" class="content-area" style="display: none;">
                    <!-- チャット形式のレイアウト -->
                    <div class="daib-chat-area" style="display: flex; flex-direction: row; width: 100%;">
                        <!-- メインチャットエリア -->
                        <div style="flex: 1; display: flex; flex-direction: column; border-right: 1px solid var(--daib-border);">
                            <!-- DAIBチャット -->
                            <div id="general-chat" class="chat-content">
                                <div class="daib-chat-messages" style="flex: 1; padding: 16px; overflow-y: auto; background: var(--daib-background); height: calc(100vh - 200px);">
                                    <!-- DAIBウェルカムメッセージ -->
                                    <div style="padding: 20px; border-left: 4px solid var(--daib-primary); background: rgba(102, 51, 153, 0.05); margin-bottom: 16px;">
                                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                                            <div style="width: 40px; height: 40px; background: var(--daib-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                                <i class="fas fa-robot" style="color: white; font-size: 18px;"></i>
                                            </div>
                                            <div>
                                                <div style="font-weight: 600; color: var(--daib-primary); font-size: 16px;">DAIB 教員アシスタント</div>
                                                <div style="font-size: 12px; color: #666;">学習支援AI</div>
                                            </div>
                                        </div>
                                        <div style="line-height: 1.6;">
                                            <p style="margin: 0 0 12px 0;">こんにちは！DAIB教員アシスタントです。授業準備や学習支援に関するご質問にお答えします。</p>
                                            <div style="font-size: 14px; color: var(--daib-text-light);">
                                                <strong>🔹 できること：</strong><br>
                                                • 授業内容に関する質問・相談<br>
                                                • 教材作成のサポート<br>
                                                • 学習指導のアドバイス<br>
                                                • システム使用方法の案内
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- チャット入力欄 -->
                                <div class="daib-chat-input" style="padding: 16px; border-top: 1px solid var(--daib-border); background: var(--daib-surface);">
                                    <div style="position: relative;">
                                        <textarea id="chat-input" placeholder="メッセージを入力してください..." 
                                                 style="width: 100%; height: 60px; resize: none; padding: 12px 50px 12px 12px; border: 1px solid var(--daib-border); border-radius: 8px; font-family: inherit;"></textarea>
                                        <button onclick="sendMessage()" class="daib-btn daib-btn-primary" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); padding: 8px 12px;">
                                            <i class="fas fa-paper-plane"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- データサイエンス基礎チャット -->
                            <div id="data-science-chat" class="chat-content" style="display: none;">
                                <div class="daib-chat-messages" style="flex: 1; padding: 16px; overflow-y: auto; background: var(--daib-background); height: calc(100vh - 200px);">
                                    <!-- 専用ウェルカムメッセージ -->
                                    <div style="padding: 20px; border-left: 4px solid var(--daib-primary); background: rgba(102, 51, 153, 0.05); margin-bottom: 16px;">
                                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                                            <div style="width: 40px; height: 40px; background: var(--daib-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                                <i class="fas fa-chart-bar" style="color: white; font-size: 18px;"></i>
                                            </div>
                                            <div>
                                                <div style="font-weight: 600; color: var(--daib-primary); font-size: 16px;">DAIB</div>
                                                <div style="font-size: 12px; color: #666;">データサイエンス基礎</div>
                                            </div>
                                        </div>
                                        <div style="line-height: 1.6;">
                                            <p style="margin: 0 0 12px 0;">データサイエンス基礎の授業準備をサポートします。右のメニューから機能を選択してください。</p>
                                        </div>
                                    </div>
                                    
                                    <!-- 機能選択後のコンテンツエリア -->
                                    <div id="chat-feature-content">
                                        <!-- 機能選択後のコンテンツが表示される -->
                                    </div>
                                </div>
                                
                                <!-- 専用入力欄 -->
                                <div class="daib-chat-input" style="padding: 16px; border-top: 1px solid var(--daib-border); background: var(--daib-surface);">
                                    <div style="position: relative;">
                                        <textarea id="chat-input-ds" placeholder="データサイエンス基礎について質問してください..." 
                                                 style="width: 100%; height: 60px; resize: none; padding: 12px 50px 12px 12px; border: 1px solid var(--daib-border); border-radius: 8px; font-family: inherit;"></textarea>
                                        <button onclick="sendMessage('data-science')" class="daib-btn daib-btn-primary" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); padding: 8px 12px;">
                                            <i class="fas fa-paper-plane"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- データサイエンス概論チャット -->
                            <div id="data-overview-chat" class="chat-content" style="display: none;">
                                <div class="daib-chat-messages" style="flex: 1; padding: 16px; overflow-y: auto; background: var(--daib-background); height: calc(100vh - 200px);">
                                    <!-- 専用ウェルカムメッセージ -->
                                    <div style="padding: 20px; border-left: 4px solid var(--daib-primary); background: rgba(102, 51, 153, 0.05); margin-bottom: 16px;">
                                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                                            <div style="width: 40px; height: 40px; background: var(--daib-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                                <i class="fas fa-database" style="color: white; font-size: 18px;"></i>
                                            </div>
                                            <div>
                                                <div style="font-weight: 600; color: var(--daib-primary); font-size: 16px;">DAIB</div>
                                                <div style="font-size: 12px; color: #666;">データサイエンス概論</div>
                                            </div>
                                        </div>
                                        <div style="line-height: 1.6;">
                                            <p style="margin: 0 0 12px 0;">データサイエンス概論の授業準備をサポートします。右のメニューから機能を選択してください。</p>
                                        </div>
                                    </div>
                                    
                                    <!-- 機能選択後のコンテンツエリア -->
                                    <div id="chat-feature-content-overview">
                                        <!-- 機能選択後のコンテンツが表示される -->
                                    </div>
                                </div>
                                
                                <!-- 専用入力欄 -->
                                <div class="daib-chat-input" style="padding: 16px; border-top: 1px solid var(--daib-border); background: var(--daib-surface);">
                                    <div style="position: relative;">
                                        <textarea id="chat-input-do" placeholder="データサイエンス概論について質問してください..." 
                                                 style="width: 100%; height: 60px; resize: none; padding: 12px 50px 12px 12px; border: 1px solid var(--daib-border); border-radius: 8px; font-family: inherit;"></textarea>
                                        <button onclick="sendMessage('data-overview')" class="daib-btn daib-btn-primary" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); padding: 8px 12px;">
                                            <i class="fas fa-paper-plane"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 右サイドバー（科目選択時のみ表示） -->
                        <div id="chat-right-menu" style="width: 350px; background: var(--daib-surface); display: none;">
                            <div style="padding: 16px; border-bottom: 1px solid var(--daib-border);">
                                <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">メニュー ></h3>
                                <p style="margin: 0; font-size: 12px; color: var(--daib-text-light);">機能を選択してください</p>
                            </div>
                            
                            <div style="padding: 16px; overflow-y: auto; height: calc(100vh - 200px);">
                                <!-- 授業回選択 -->
                                <div style="margin-bottom: 24px;">
                                    <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px; color: var(--daib-text);">授業回</label>
                                    <select class="daib-input" id="chat-week-select" onchange="changeChatWeek()">
                                        <option value="1">第1回</option>
                                        <option value="2">第2回</option>
                                        <option value="3">第3回</option>
                                        <option value="4">第4回</option>
                                        <option value="5">第5回</option>
                                        <option value="6">第6回</option>
                                        <option value="7" selected>第7回</option>
                                        <option value="8">第8回</option>
                                        <option value="9">第9回</option>
                                        <option value="10">第10回</option>
                                        <option value="11">第11回</option>
                                        <option value="12">第12回</option>
                                        <option value="13">第13回</option>
                                        <option value="14">第14回</option>
                                        <option value="15">第15回</option>
                                    </select>
                                </div>
                                
                                <!-- メニュー項目 -->
                                <div style="display: flex; flex-direction: column; gap: 20px;">
                                    <!-- 設問作成セクション -->
                                    <div>
                                        <h4 style="margin: 0 0 12px 0; font-weight: 600; color: var(--daib-text); font-size: 14px; border-bottom: 1px solid var(--daib-border); padding-bottom: 4px;">▼ 設問作成</h4>
                                        <div style="padding-left: 12px; display: flex; flex-direction: column; gap: 8px;">
                                            <a href="#" onclick="showChatFeature('fill-blank')" style="font-size: 13px; color: var(--daib-text-light); text-decoration: none; hover:color: var(--daib-primary);">・穴埋め式</a>
                                            <a href="#" onclick="showChatFeature('multiple-choice')" style="font-size: 13px; color: var(--daib-text-light); text-decoration: none;">・選択式</a>
                                            <a href="#" onclick="showChatFeature('free-response')" style="font-size: 13px; color: var(--daib-text-light); text-decoration: none;">・自由記述式</a>
                                        </div>
                                    </div>
                                    
                                    <!-- 講義資料キーワードセクション -->
                                    <div>
                                        <h4 style="margin: 0 0 12px 0; font-weight: 600; color: var(--daib-text); font-size: 14px; border-bottom: 1px solid var(--daib-border); padding-bottom: 4px;">▼ 講義資料キーワード</h4>
                                        <div style="padding-left: 12px; display: flex; flex-direction: column; gap: 8px;">
                                            <a href="#" onclick="showChatFeature('keyword-analysis')" style="font-size: 13px; color: var(--daib-text-light); text-decoration: none;">・2×2分割表の指標</a>
                                            <a href="#" onclick="showChatFeature('keyword-risk')" style="font-size: 13px; color: var(--daib-text-light); text-decoration: none;">・リスク差・リスク比・オッズ比</a>
                                            <a href="#" onclick="showChatFeature('keyword-matrix')" style="font-size: 13px; color: var(--daib-text-light); text-decoration: none;">・混同行列とは</a>
                                            <a href="#" onclick="showChatFeature('keyword-regression')" style="font-size: 13px; color: var(--daib-text-light); text-decoration: none;">・回帰分析の目的</a>
                                            <a href="#" onclick="showChatFeature('keyword-model')" style="font-size: 13px; color: var(--daib-text-light); text-decoration: none;">・単回帰モデルとは</a>
                                        </div>
                                    </div>
                                    
                                    <!-- 参考資料キーワードセクション -->
                                    <div>
                                        <h4 style="margin: 0 0 12px 0; font-weight: 600; color: var(--daib-text); font-size: 14px; border-bottom: 1px solid var(--daib-border); padding-bottom: 4px;">▼ 参考資料キーワード</h4>
                                        <div style="padding-left: 12px;">
                                            <p style="margin: 0; font-size: 13px; color: var(--daib-text-light);">参考資料の主要キーワードを表示</p>
                                        </div>
                                    </div>
                                    
                                    <!-- 動画検索セクション -->
                                    <div>
                                        <h4 style="margin: 0 0 12px 0; font-weight: 600; color: var(--daib-text); font-size: 14px; border-bottom: 1px solid var(--daib-border); padding-bottom: 4px;">▼ 動画検索</h4>
                                        <div style="padding-left: 12px;">
                                            <a href="#" onclick="showChatFeature('video-search')" style="font-size: 13px; color: var(--daib-text-light); text-decoration: none;">・講義動画をキーワードで検索</a>
                                        </div>
                                    </div>
                                    
                                    <!-- スライド作成セクション -->
                                    <div>
                                        <h4 style="margin: 0 0 12px 0; font-weight: 600; color: var(--daib-text); font-size: 14px; border-bottom: 1px solid var(--daib-border); padding-bottom: 4px;">▼ スライド作成</h4>
                                        <div style="padding-left: 12px;">
                                            <a href="#" onclick="showChatFeature('slide-create')" style="font-size: 13px; color: var(--daib-text-light); text-decoration: none;">・授業スライドの自動生成</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 講義資料・動画アップロード（チャット外） -->
                    <div id="upload-content" class="daib-content-section" style="display: none;">
                        <div class="daib-content-header">
                            <h1 class="daib-content-title">講義資料・動画アップロード</h1>
                            <div class="daib-content-actions">
                                <button onclick="uploadFiles()" class="daib-btn daib-btn-primary">
                                    <i class="fas fa-plus"></i>
                                    新規アップロード
                                </button>
                            </div>
                        </div>

                        <div class="daib-learning-content">
                            <!-- アップロード領域 -->
                            <div class="content-card">
                                <h3 style="margin-bottom: 16px;">ファイルアップロード</h3>
                                <div class="upload-area" style="border: 2px dashed var(--daib-border); border-radius: 8px; padding: 40px; text-align: center; background: var(--daib-surface);">
                                    <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: var(--daib-primary); margin-bottom: 16px;"></i>
                                    <p style="margin-bottom: 16px; color: var(--daib-text-light);">PowerAppsファイル、動画ファイルをドラッグ&ドロップまたはクリックしてアップロード</p>
                                    <button class="daib-btn daib-btn-secondary">ファイルを選択</button>
                                </div>
                            </div>

                            <!-- アップロード済みファイル一覧 -->
                            <div class="content-card">
                                <h3 style="margin-bottom: 16px;">アップロード済みファイル</h3>
                                <div class="file-list">
                                    <div class="file-item" style="display: flex; align-items: center; padding: 12px; border: 1px solid var(--daib-border); border-radius: 6px; margin-bottom: 8px;">
                                        <i class="fas fa-file-powerpoint" style="color: #d04a37; margin-right: 12px;"></i>
                                        <div style="flex: 1;">
                                            <div style="font-weight: 500;">第7回_データサイエンス基礎.pptx</div>
                                            <div style="font-size: 12px; color: var(--daib-text-light);">アップロード日: 2025-07-15 14:30</div>
                                        </div>
                                        <button class="daib-btn daib-btn-danger" style="padding: 4px 8px; font-size: 12px;">削除</button>
                                    </div>
                                    <div class="file-item" style="display: flex; align-items: center; padding: 12px; border: 1px solid var(--daib-border); border-radius: 6px; margin-bottom: 8px;">
                                        <i class="fas fa-video" style="color: #1976d2; margin-right: 12px;"></i>
                                        <div style="flex: 1;">
                                            <div style="font-weight: 500;">回帰分析解説動画.mp4</div>
                                            <div style="font-size: 12px; color: var(--daib-text-light);">アップロード日: 2025-07-15 14:25</div>
                                        </div>
                                        <button class="daib-btn daib-btn-danger" style="padding: 4px 8px; font-size: 12px;">削除</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- 授業振り返りコンテンツ -->
                <div id="review-area" class="content-area">
                    <!-- 共通ヘッダー -->
                    <div class="daib-content-header">
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <h1 class="daib-content-title" id="review-page-title">教員ダッシュボード</h1>
                            <div>
                                <label style="font-size: 12px; color: #666; margin-right: 8px;">授業選択:</label>
                                <select class="daib-input" style="width: 200px; font-size: 14px;" id="review-subject-select" onchange="changeReviewSubject()">
                                    <option value="data-science">データサイエンス基礎</option>
                                    <option value="data-overview">データサイエンス概論</option>
                                </select>
                            </div>
                            <div>
                                <label style="font-size: 12px; color: #666; margin-right: 8px;">講義回:</label>
                                <select class="daib-input" style="width: 120px; font-size: 14px;" id="review-week-select" onchange="changeReviewWeek()">
                                    <option value="1">第1回</option>
                                    <option value="2">第2回</option>
                                    <option value="3">第3回</option>
                                    <option value="4">第4回</option>
                                    <option value="5">第5回</option>
                                    <option value="6">第6回</option>
                                    <option value="7" selected>第7回</option>
                                    <option value="8">第8回</option>
                                    <option value="9">第9回</option>
                                    <option value="10">第10回</option>
                                    <option value="11">第11回</option>
                                    <option value="12">第12回</option>
                                    <option value="13">第13回</option>
                                    <option value="14">第14回</option>
                                    <option value="15">第15回</option>
                                </select>
                            </div>
                        </div>
                        <div class="daib-content-actions" id="review-actions">
                            <button onclick="generateReport()" class="daib-btn daib-btn-primary">
                                <i class="fas fa-download"></i>
                                レポート生成
                            </button>
                        </div>
                    </div>

                    <!-- 教員ダッシュボード -->
                    <div id="dashboard-content" class="daib-content-section">
                        <div class="daib-learning-content">
                            <!-- タブナビゲーション -->
                            <div class="content-card" style="padding: 0; margin-bottom: 24px;">
                                <div style="display: flex; border-bottom: 1px solid var(--daib-border);">
                                    <button class="tab-button active" data-tab="overview" style="flex: 1; padding: 16px; border: none; background: none; border-bottom: 3px solid var(--daib-primary); color: var(--daib-primary); font-weight: 600;">
                                        <i class="fas fa-chart-line" style="margin-right: 8px;"></i>
                                        概要
                                    </button>
                                    <button class="tab-button" data-tab="understanding" style="flex: 1; padding: 16px; border: none; background: none; border-bottom: 3px solid transparent; color: var(--daib-text-light);">
                                        <i class="fas fa-search" style="margin-right: 8px;"></i>
                                        キーワード理解度分析
                                    </button>
                                    <button class="tab-button" data-tab="students" style="flex: 1; padding: 16px; border: none; background: none; border-bottom: 3px solid transparent; color: var(--daib-text-light);">
                                        <i class="fas fa-users" style="margin-right: 8px;"></i>
                                        学生管理
                                    </button>
                                    <button class="tab-button" data-tab="lectures" style="flex: 1; padding: 16px; border: none; background: none; border-bottom: 3px solid transparent; color: var(--daib-text-light);">
                                        <i class="fas fa-brain" style="margin-right: 8px;"></i>
                                        第7回講義分析
                                    </button>
                                    <button class="tab-button" data-tab="final-correlation" style="flex: 1; padding: 16px; border: none; background: none; border-bottom: 3px solid transparent; color: var(--daib-text-light);">
                                        <i class="fas fa-chart-pie" style="margin-right: 8px;"></i>
                                        最終相関分析
                                    </button>
                                </div>
                            </div>

                            <!-- 概要タブ -->
                            <div id="overview-tab" class="tab-content active">
                                <!-- AI総合評価 -->
                                <div class="content-card" style="background: linear-gradient(135deg, #f0f9f5, #e6f3ff); border: 1px solid var(--daib-primary); margin-bottom: 24px;">
                                    <div style="display: flex; align-items: center; gap: 16px;">
                                        <div style="width: 60px; height: 60px; background: var(--daib-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-robot" style="color: white; font-size: 24px;"></i>
                                        </div>
                                        <div style="flex: 1;">
                                            <h3 style="margin: 0 0 8px 0; color: var(--daib-primary); font-weight: 600;">AI総合評価</h3>
                                            <p style="margin: 0; font-size: 16px; line-height: 1.5; color: var(--daib-text);">
                                                第7回の学習状況は<strong>良好</strong>です。キーワード平均理解度73.2%と順調な進捗を示しています。
                                                特に「回帰分析の目的」「決定係数の解釈」の理解度が高く、学生の関心が高い分野と評価されます。
                                                一方で「2×2分割表の指標」については23名の学生が理解に課題を抱えており、次回授業での重点的な復習をお勧めします。
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <!-- KPI カード -->
                                <div class="stats-grid" style="margin-bottom: 24px;">
                                    <div class="stat-card">
                                        <div class="stat-card-header">
                                            <p class="stat-card-title">第7回受講者数</p>
                                            <i class="fas fa-users stat-card-icon"></i>
                                        </div>
                                        <p class="stat-card-value" id="total-students">2,200</p>
                                        <p style="font-size: 14px; color: var(--daib-success);">100% 出席率</p>
                                    </div>

                                    <div class="stat-card">
                                        <div class="stat-card-header">
                                            <p class="stat-card-title">キーワード平均理解度</p>
                                            <i class="fas fa-chart-line stat-card-icon"></i>
                                        </div>
                                        <p class="stat-card-value" id="avg-understanding">73.2%</p>
                                        <p style="font-size: 14px; color: var(--daib-success);">第6回比 +3.1%</p>
                                    </div>

                                    <div class="stat-card">
                                        <div class="stat-card-header">
                                            <p class="stat-card-title">アンケート提出率</p>
                                            <i class="fas fa-clipboard-check stat-card-icon"></i>
                                        </div>
                                        <p class="stat-card-value" id="completion-rate">84%</p>
                                        <p style="font-size: 14px; color: var(--daib-error);">未提出 16%</p>
                                    </div>

                                    <div class="stat-card">
                                        <div class="stat-card-header">
                                            <p class="stat-card-title">理解度要注意学生</p>
                                            <i class="fas fa-exclamation-triangle stat-card-icon"></i>
                                        </div>
                                        <p class="stat-card-value" id="attention-students" style="color: var(--daib-error);">352</p>
                                        <p style="font-size: 14px; color: var(--daib-success);">第6回比 -89名</p>
                                    </div>
                                </div>

                                <!-- 推移グラフ群 -->
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px; margin-bottom: 24px;">
                                    <!-- アンケート提出率推移 -->
                                    <div class="content-card">
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                                            <h3 style="margin: 0; font-size: 18px; font-weight: 600;">アンケート提出率推移</h3>
                                            <button class="daib-btn daib-btn-secondary" style="font-size: 12px; padding: 8px 12px;">詳細</button>
                                        </div>
                                        <div style="height: 250px; position: relative;">
                                            <canvas id="submissionChart"></canvas>
                                        </div>
                                    </div>

                                    <!-- アンケート理解度推移 -->
                                    <div class="content-card">
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                                            <h3 style="margin: 0; font-size: 18px; font-weight: 600;">アンケート理解度推移</h3>
                                            <button class="daib-btn daib-btn-secondary" style="font-size: 12px; padding: 8px 12px;">詳細</button>
                                        </div>
                                        <div style="height: 250px; position: relative;">
                                            <canvas id="understandingChart"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px; margin-bottom: 24px;">
                                    <!-- 個別問題回答率推移 -->
                                    <div class="content-card">
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                                            <h3 style="margin: 0; font-size: 18px; font-weight: 600;">個別問題回答率推移</h3>
                                            <button class="daib-btn daib-btn-secondary" style="font-size: 12px; padding: 8px 12px;">詳細</button>
                                        </div>
                                        <div style="height: 250px; position: relative;">
                                            <canvas id="responseChart"></canvas>
                                        </div>
                                    </div>

                                    <!-- 個別問題正答率推移 -->
                                    <div class="content-card">
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                                            <h3 style="margin: 0; font-size: 18px; font-weight: 600;">個別問題正答率推移</h3>
                                            <button class="daib-btn daib-btn-secondary" style="font-size: 12px; padding: 8px 12px;">詳細</button>
                                        </div>
                                        <div style="height: 250px; position: relative;">
                                            <canvas id="accuracyChart"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- AI相関分析 -->
                                <div class="content-card" style="margin-bottom: 24px;">
                                    <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600; color: var(--daib-primary);">
                                        <i class="fas fa-brain" style="margin-right: 8px;"></i>
                                        AI相関分析結果
                                    </h3>
                                    <div style="background: rgba(102, 51, 153, 0.05); border: 1px solid rgba(102, 51, 153, 0.2); border-radius: 8px; padding: 20px;">
                                        <div style="font-size: 14px; line-height: 1.6; color: var(--daib-text);">
                                            <p style="margin: 0 0 16px 0; font-weight: 600;">【相関分析結果】</p>
                                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 16px;">
                                                <div>
                                                    <p style="margin: 0 0 8px 0; font-weight: 600; color: var(--daib-success);">● 正の相関 (強)</p>
                                                    <ul style="margin: 0; padding-left: 16px; font-size: 13px;">
                                                        <li>アンケート提出率 ↔ 理解度 (r=0.82)</li>
                                                        <li>個別問題回答率 ↔ 正答率 (r=0.79)</li>
                                                        <li>理解度 ↔ 個別問題正答率 (r=0.74)</li>
                                                    </ul>
                                                </div>
                                                <div>
                                                    <p style="margin: 0 0 8px 0; font-weight: 600; color: var(--daib-warning);">● 正の相関 (中)</p>
                                                    <ul style="margin: 0; padding-left: 16px; font-size: 13px;">
                                                        <li>アンケート提出率 ↔ 個別問題回答率 (r=0.65)</li>
                                                        <li>アンケート提出率 ↔ 個別問題正答率 (r=0.58)</li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div style="background: white; border-radius: 6px; padding: 16px; border: 1px solid var(--daib-border);">
                                                <p style="margin: 0 0 8px 0; font-weight: 600; color: var(--daib-text);">【指導推奨】</p>
                                                <p style="margin: 0; font-size: 13px;">
                                                    アンケート提出率と理解度の高い相関から、アンケート提出を促進することで学習効果が向上します。また、個別問題の回答率と正答率の相関から、継続的な問題解決が理解度向上に繋がっています。
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- キーワード別理解度 -->
                                <div class="content-card">
                                    <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">第7回: データサイエンス基礎 - キーワード別理解度</h3>
                                    <div id="keyword-understanding-list" style="max-height: 300px; overflow-y: auto;">
                                        <!-- キーワード理解度がJSで挿入される -->
                                    </div>
                                </div>
                            </div>

                            <!-- 理解度分析タブ -->
                            <div id="understanding-tab" class="tab-content" style="display: none;">
                                <div class="content-card">
                                    <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">理解度ヒートマップ</h3>
                                    <div style="overflow-x: auto; width: 100%; max-width: 100%;">
                                        <div id="heatmap-container" style="min-width: 100%; max-width: none;">
                                            <!-- ヒートマップがJSで生成される -->
                                        </div>
                                    </div>
                                    
                                    <!-- 凡例 -->
                                    <div style="margin-top: 24px; display: flex; align-items: center; justify-content: center; gap: 24px; font-size: 12px;">
                                        <span>理解度レベル:</span>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <div style="width: 16px; height: 16px; background: #dc2626; border-radius: 3px;"></div>
                                            <span>低 (1-2)</span>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <div style="width: 16px; height: 16px; background: #f59e0b; border-radius: 3px;"></div>
                                            <span>普通 (3)</span>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <div style="width: 16px; height: 16px; background: #10b981; border-radius: 3px;"></div>
                                            <span>高 (4)</span>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <div style="width: 16px; height: 16px; background: #059669; border-radius: 3px;"></div>
                                            <span>非常に高 (5)</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 学生管理タブ -->
                            <div id="students-tab" class="tab-content" style="display: none;">
                                <div class="content-card">
                                    <h3 style="margin-bottom: 16px;">学生一覧</h3>
                                    <div class="table-container" style="overflow-x: auto; width: 100%; max-width: 100%;">
                                        <table style="width: 100%; border-collapse: collapse; table-layout: fixed;">
                                            <thead>
                                                <tr style="background: var(--daib-surface);">
                                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid var(--daib-border); width: 15%;">学生ID</th>
                                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid var(--daib-border); width: 30%;">氏名</th>
                                                    <th style="padding: 12px; text-align: center; border-bottom: 1px solid var(--daib-border); width: 20%;">理解度</th>
                                                    <th style="padding: 12px; text-align: center; border-bottom: 1px solid var(--daib-border); width: 15%;">問題数</th>
                                                    <th style="padding: 12px; text-align: center; border-bottom: 1px solid var(--daib-border); width: 20%;">状態</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td style="padding: 12px; border-bottom: 1px solid var(--daib-border);">ST001</td>
                                                    <td style="padding: 12px; border-bottom: 1px solid var(--daib-border);">山田太郎</td>
                                                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid var(--daib-border);">78%</td>
                                                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid var(--daib-border);">5問</td>
                                                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid var(--daib-border);">
                                                        <span style="background: var(--daib-success); color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">完了</span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="padding: 12px; border-bottom: 1px solid var(--daib-border);">ST002</td>
                                                    <td style="padding: 12px; border-bottom: 1px solid var(--daib-border);">佐藤花子</td>
                                                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid var(--daib-border);">85%</td>
                                                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid var(--daib-border);">4問</td>
                                                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid var(--daib-border);">
                                                        <span style="background: var(--daib-success); color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">完了</span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="padding: 12px; border-bottom: 1px solid var(--daib-border);">ST003</td>
                                                    <td style="padding: 12px; border-bottom: 1px solid var(--daib-border);">田中一郎</td>
                                                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid var(--daib-border);">65%</td>
                                                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid var(--daib-border);">6問</td>
                                                    <td style="padding: 12px; text-align: center; border-bottom: 1px solid var(--daib-border);">
                                                        <span style="background: var(--daib-warning); color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">進行中</span>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- 講義別分析タブ -->
                            <div id="lectures-tab" class="tab-content" style="display: none;">
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                                    <div class="content-card">
                                        <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">講義別統計</h3>
                                        <div id="lecture-stats" style="font-size: 16px; line-height: 1.6;">
                                            <div style="padding: 12px; background: var(--daib-background); border-radius: 8px; margin-bottom: 12px;">
                                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                                    <span style="font-weight: 600;">受講者数</span>
                                                    <span style="color: var(--daib-primary); font-weight: 700;">2,200名</span>
                                                </div>
                                            </div>
                                            <div style="padding: 12px; background: var(--daib-background); border-radius: 8px; margin-bottom: 12px;">
                                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                                    <span style="font-weight: 600;">アンケート回答率</span>
                                                    <span style="color: var(--daib-success); font-weight: 700;">84%</span>
                                                </div>
                                            </div>
                                            <div style="padding: 12px; background: var(--daib-background); border-radius: 8px; margin-bottom: 12px;">
                                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                                    <span style="font-weight: 600;">平均学習時間</span>
                                                    <span style="color: var(--daib-primary); font-weight: 700;">45分</span>
                                                </div>
                                            </div>
                                            <div style="padding: 12px; background: var(--daib-background); border-radius: 8px;">
                                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                                    <span style="font-weight: 600;">理解度向上率</span>
                                                    <span style="color: var(--daib-success); font-weight: 700;">+12.3%</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="content-card">
                                        <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">改善提案</h3>
                                        <div style="font-size: 14px; line-height: 1.5;">
                                            <div style="padding: 16px; background: rgba(220, 38, 38, 0.05); border: 1px solid rgba(220, 38, 38, 0.2); border-radius: 8px; margin-bottom: 16px;">
                                                <h4 style="font-weight: 600; color: var(--daib-error); margin: 0 0 8px 0;">2×2分割表の指標</h4>
                                                <p style="margin: 0 0 8px 0; color: var(--daib-error);">理解度が低下しています（2.1/5.0）</p>
                                                <ul style="margin: 0; padding-left: 16px; color: var(--daib-error);">
                                                    <li>基礎概念の復習時間を増やす</li>
                                                    <li>実習例題を追加する</li>
                                                    <li>視覚的な説明を充実させる</li>
                                                </ul>
                                            </div>
                                            
                                            <div style="padding: 16px; background: rgba(5, 150, 105, 0.05); border: 1px solid rgba(5, 150, 105, 0.2); border-radius: 8px;">
                                                <h4 style="font-weight: 600; color: var(--daib-success); margin: 0 0 8px 0;">決定係数の解釈</h4>
                                                <p style="margin: 0 0 8px 0; color: var(--daib-success);">高い満足度を維持（4.6/5.0）</p>
                                                <ul style="margin: 0; padding-left: 16px; color: var(--daib-success);">
                                                    <li>実習時間の延長を検討</li>
                                                    <li>高度な応用例を紹介</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 最終相関分析タブ -->
                            <div id="final-correlation-tab" class="tab-content" style="display: none;">
                                <!-- 最終相関分析ヘッダー -->
                                <div class="content-card" style="background: linear-gradient(135deg, #f0f9f5, #e6f3ff); border: 1px solid var(--daib-primary); margin-bottom: 24px;">
                                    <div style="display: flex; align-items: center; gap: 16px;">
                                        <div style="width: 60px; height: 60px; background: var(--daib-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-chart-pie" style="color: white; font-size: 24px;"></i>
                                        </div>
                                        <div style="flex: 1;">
                                            <h3 style="margin: 0 0 8px 0; color: var(--daib-primary); font-weight: 600;">最終相関分析結果（事後分析）</h3>
                                            <p style="margin: 0; font-size: 16px; line-height: 1.5; color: var(--daib-text);">
                                                全15回の授業と期末試験がすべて完了し、実際の成績データを用いた総合的な相関分析結果です。
                                                学習成果に影響する主要因子と来年度への改善提案を示します。
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <!-- 相関マトリックスヒートマップ -->
                                <div class="content-card" style="margin-bottom: 24px;">
                                    <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">学習指標相関マトリックス（実際データベース）</h3>
                                    <div style="display: flex; justify-content: center; margin-bottom: 16px;">
                                        <canvas id="correlationMatrix" style="max-width: 600px; max-height: 400px;"></canvas>
                                    </div>
                                    <div style="display: flex; justify-content: center; gap: 16px; font-size: 12px;">
                                        <div style="display: flex; align-items: center; gap: 4px;">
                                            <div style="width: 12px; height: 12px; background: #059669; border-radius: 2px;"></div>
                                            <span>強い正の相関 (0.7-1.0)</span>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 4px;">
                                            <div style="width: 12px; height: 12px; background: #10b981; border-radius: 2px;"></div>
                                            <span>中程度の正の相関 (0.4-0.7)</span>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 4px;">
                                            <div style="width: 12px; height: 12px; background: #f59e0b; border-radius: 2px;"></div>
                                            <span>弱い相関 (0.0-0.4)</span>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 4px;">
                                            <div style="width: 12px; height: 12px; background: #dc2626; border-radius: 2px;"></div>
                                            <span>負の相関 (-1.0-0.0)</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- 成績予測モデルと学生群分析 -->
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px; margin-bottom: 24px;">
                                    <!-- 成績予測モデルの精度検証 -->
                                    <div class="content-card">
                                        <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">予測モデル精度検証</h3>
                                        <div style="height: 300px; position: relative;">
                                            <canvas id="predictionModel"></canvas>
                                        </div>
                                        <div style="margin-top: 12px; font-size: 12px; color: var(--daib-text-light); text-align: center;">
                                            予測精度: 87.3% | 理想ラインからの平均偏差: 6.8%
                                        </div>
                                    </div>

                                    <!-- 学生群分析 -->
                                    <div class="content-card">
                                        <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">学生群分析</h3>
                                        <div style="height: 300px; position: relative;">
                                            <canvas id="studentClusters"></canvas>
                                        </div>
                                        <div style="margin-top: 12px; font-size: 12px; color: var(--daib-text-light); text-align: center;">
                                            優秀群: 23% | 中程度群: 51% | 要注意群: 26%
                                        </div>
                                    </div>
                                </div>

                                <!-- 詳細分析結果 -->
                                <div class="content-card" style="margin-bottom: 24px;">
                                    <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600; color: var(--daib-primary);">
                                        <i class="fas fa-microscope" style="margin-right: 8px;"></i>
                                        詳細分析結果
                                    </h3>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px;">
                                        <!-- 主要相関関係 -->
                                        <div style="background: rgba(102, 51, 153, 0.05); border: 1px solid rgba(102, 51, 153, 0.2); border-radius: 8px; padding: 16px;">
                                            <h4 style="margin: 0 0 12px 0; font-weight: 600; color: var(--daib-primary);">主要相関関係</h4>
                                            <div style="font-size: 13px; line-height: 1.5;">
                                                <div style="margin-bottom: 12px;">
                                                    <p style="margin: 0 0 4px 0; font-weight: 600; color: var(--daib-success);">● 期末試験成績の予測因子</p>
                                                    <ul style="margin: 0; padding-left: 16px;">
                                                        <li>1. アンケート理解度 (r=0.89)</li>
                                                        <li>2. 個別問題正答率 (r=0.83)</li>
                                                        <li>3. アンケート提出率 (r=0.76)</li>
                                                        <li>4. 個別問題回答率 (r=0.68)</li>
                                                    </ul>
                                                </div>
                                                <div style="background: white; border-radius: 6px; padding: 12px; border: 1px solid var(--daib-border);">
                                                    <p style="margin: 0 0 8px 0; font-weight: 600; color: var(--daib-text);">重要な発見:</p>
                                                    <p style="margin: 0; font-size: 12px;">
                                                        アンケート理解度が期末試験成績と最も強い相関を示しています。定期的な理解度確認が学習成果向上のカギです。
                                                    </p>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 要注意学生の特徴 -->
                                        <div style="background: rgba(220, 38, 38, 0.05); border: 1px solid rgba(220, 38, 38, 0.2); border-radius: 8px; padding: 16px;">
                                            <h4 style="margin: 0 0 12px 0; font-weight: 600; color: var(--daib-error);">要注意学生の特徴</h4>
                                            <div style="font-size: 13px; line-height: 1.5;">
                                                <div style="margin-bottom: 12px;">
                                                    <p style="margin: 0 0 4px 0; font-weight: 600; color: var(--daib-error);">● 共通パターン (572名対象)</p>
                                                    <ul style="margin: 0; padding-left: 16px;">
                                                        <li>アンケート提出率 < 60%</li>
                                                        <li>理解度の低下傾向 (第3回以降)</li>
                                                        <li>個別問題回答率 < 40%</li>
                                                        <li>連続3回以上の未提出</li>
                                                    </ul>
                                                </div>
                                                <div style="background: white; border-radius: 6px; padding: 12px; border: 1px solid var(--daib-border);">
                                                    <p style="margin: 0 0 8px 0; font-weight: 600; color: var(--daib-text);">早期介入推奨:</p>
                                                    <p style="margin: 0; font-size: 12px;">
                                                        第4回授業時点で特定可能。個別サポートとアンケート提出促進が有効。
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 改善推奨 -->
                                <div class="content-card">
                                    <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600; color: var(--daib-success);">
                                        <i class="fas fa-lightbulb" style="margin-right: 8px;"></i>
                                        改善推奨
                                    </h3>
                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                                        <!-- 短期的改善 -->
                                        <div style="background: rgba(5, 150, 105, 0.05); border: 1px solid rgba(5, 150, 105, 0.2); border-radius: 8px; padding: 16px;">
                                            <h4 style="margin: 0 0 12px 0; font-weight: 600; color: var(--daib-success);">短期的改善</h4>
                                            <ul style="margin: 0; padding-left: 16px; font-size: 13px; line-height: 1.5;">
                                                <li>アンケート提出率の向上施策</li>
                                                <li>個別問題の難易度調整</li>
                                                <li>理解度低下学生の早期発見</li>
                                                <li>リアルタイムフィードバック</li>
                                            </ul>
                                        </div>

                                        <!-- 中期的改善 -->
                                        <div style="background: rgba(2, 132, 199, 0.05); border: 1px solid rgba(2, 132, 199, 0.2); border-radius: 8px; padding: 16px;">
                                            <h4 style="margin: 0 0 12px 0; font-weight: 600; color: var(--daib-info);">中期的改善</h4>
                                            <ul style="margin: 0; padding-left: 16px; font-size: 13px; line-height: 1.5;">
                                                <li>アダプティブラーニングの導入</li>
                                                <li>学習スタイル別教材提供</li>
                                                <li>ピアサポートシステム</li>
                                                <li>ゲーミフィケーション要素</li>
                                            </ul>
                                        </div>

                                        <!-- 長期的改善 -->
                                        <div style="background: rgba(168, 85, 247, 0.05); border: 1px solid rgba(168, 85, 247, 0.2); border-radius: 8px; padding: 16px;">
                                            <h4 style="margin: 0 0 12px 0; font-weight: 600; color: var(--daib-primary);">長期的改善</h4>
                                            <ul style="margin: 0; padding-left: 16px; font-size: 13px; line-height: 1.5;">
                                                <li>カリキュラム構成の最適化</li>
                                                <li>予測モデルの精度向上</li>
                                                <li>個別指導システム構築</li>
                                                <li>継続改善サイクルの確立</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 授業回キーワード管理 -->
                    <div id="keyword-management-content" class="daib-content-section" style="display: none;">
                        <div class="daib-learning-content">
                            <!-- 講義情報 -->
                            <div class="content-card" style="margin-bottom: 24px;">
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div>
                                        <h3 style="margin: 0 0 8px 0;">講義情報</h3>
                                        <div style="display: flex; align-items: center; gap: 24px; font-size: 14px; color: var(--daib-text-light);">
                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                <i class="fas fa-book"></i>
                                                <span id="lecture-title">データサイエンス基礎第7回</span>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                <i class="fas fa-calendar"></i>
                                                <span id="lecture-week">第7週</span>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                <i class="fas fa-tags"></i>
                                                <span><span id="keyword-count">8</span>個のキーワード</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 12px;">
                                        <button onclick="addNewKeyword()" class="daib-btn daib-btn-success">
                                            <i class="fas fa-plus"></i>
                                            新規キーワード追加
                                        </button>
                                        <button onclick="saveAllKeywords()" class="daib-btn daib-btn-primary">
                                            <i class="fas fa-save"></i>
                                            すべて保存
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- キーワード一覧 -->
                            <div class="content-card" style="margin-bottom: 24px;">
                                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                                    <h3 style="margin: 0;">キーワード一覧</h3>
                                    <div style="display: flex; align-items: center; gap: 16px;">
                                        <select id="sort-select" onchange="sortKeywords()" class="daib-input" style="width: 150px; font-size: 14px;">
                                            <option value="order">登録順</option>
                                            <option value="name">名前順</option>
                                            <option value="importance">重要度順</option>
                                        </select>
                                        <button onclick="resetKeywords()" class="daib-btn daib-btn-secondary" style="font-size: 14px; padding: 8px 12px;">
                                            <i class="fas fa-redo"></i>
                                            リセット
                                        </button>
                                    </div>
                                </div>

                                <div id="keywords-list" style="max-height: 400px; overflow-y: auto;">
                                    <!-- キーワードリスト -->
                                    <div class="keyword-item" style="border: 1px solid var(--daib-border); border-radius: 8px; padding: 16px; margin-bottom: 12px; background: var(--daib-surface);">
                                        <div style="display: flex; align-items: start; gap: 16px;">
                                            <div style="flex: 1;">
                                                <input type="text" value="2×2分割表の指標" class="daib-input" style="font-weight: 600; margin-bottom: 8px;">
                                                <textarea placeholder="キーワードの説明を入力..." class="daib-input" style="min-height: 60px; margin-bottom: 12px;">感度、特異度、精度などの評価指標について学習します。</textarea>
                                                <div style="display: flex; gap: 16px; align-items: center;">
                                                    <div>
                                                        <label style="font-size: 12px; color: var(--daib-text-light);">重要度:</label>
                                                        <select class="daib-input" style="width: 100px; font-size: 14px;">
                                                            <option value="1">1 - 低</option>
                                                            <option value="2">2 - やや低</option>
                                                            <option value="3" selected>3 - 中</option>
                                                            <option value="4">4 - やや高</option>
                                                            <option value="5">5 - 高</option>
                                                        </select>
                                                    </div>
                                                    <div style="display: flex; align-items: center; gap: 8px;">
                                                        <input type="checkbox" id="keyword1-active" checked>
                                                        <label for="keyword1-active" style="font-size: 14px;">有効</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                                <button class="daib-btn daib-btn-secondary" style="padding: 4px 8px; font-size: 12px;">
                                                    <i class="fas fa-grip-vertical"></i>
                                                </button>
                                                <button class="daib-btn daib-btn-danger" style="padding: 4px 8px; font-size: 12px;">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="keyword-item" style="border: 1px solid var(--daib-border); border-radius: 8px; padding: 16px; margin-bottom: 12px; background: var(--daib-surface);">
                                        <div style="display: flex; align-items: start; gap: 16px;">
                                            <div style="flex: 1;">
                                                <input type="text" value="リスク差・リスク比・オッズ比" class="daib-input" style="font-weight: 600; margin-bottom: 8px;">
                                                <textarea placeholder="キーワードの説明を入力..." class="daib-input" style="min-height: 60px; margin-bottom: 12px;">疫学研究における関連性の指標について学習します。</textarea>
                                                <div style="display: flex; gap: 16px; align-items: center;">
                                                    <div>
                                                        <label style="font-size: 12px; color: var(--daib-text-light);">重要度:</label>
                                                        <select class="daib-input" style="width: 100px; font-size: 14px;">
                                                            <option value="1">1 - 低</option>
                                                            <option value="2">2 - やや低</option>
                                                            <option value="3">3 - 中</option>
                                                            <option value="4" selected>4 - やや高</option>
                                                            <option value="5">5 - 高</option>
                                                        </select>
                                                    </div>
                                                    <div style="display: flex; align-items: center; gap: 8px;">
                                                        <input type="checkbox" id="keyword2-active" checked>
                                                        <label for="keyword2-active" style="font-size: 14px;">有効</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                                <button class="daib-btn daib-btn-secondary" style="padding: 4px 8px; font-size: 12px;">
                                                    <i class="fas fa-grip-vertical"></i>
                                                </button>
                                                <button class="daib-btn daib-btn-danger" style="padding: 4px 8px; font-size: 12px;">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="keyword-item" style="border: 1px solid var(--daib-border); border-radius: 8px; padding: 16px; margin-bottom: 12px; background: var(--daib-surface);">
                                        <div style="display: flex; align-items: start; gap: 16px;">
                                            <div style="flex: 1;">
                                                <input type="text" value="混同行列とは" class="daib-input" style="font-weight: 600; margin-bottom: 8px;">
                                                <textarea placeholder="キーワードの説明を入力..." class="daib-input" style="min-height: 60px; margin-bottom: 12px;">分類モデルの性能評価に使用される表について学習します。</textarea>
                                                <div style="display: flex; gap: 16px; align-items: center;">
                                                    <div>
                                                        <label style="font-size: 12px; color: var(--daib-text-light);">重要度:</label>
                                                        <select class="daib-input" style="width: 100px; font-size: 14px;">
                                                            <option value="1">1 - 低</option>
                                                            <option value="2">2 - やや低</option>
                                                            <option value="3" selected>3 - 中</option>
                                                            <option value="4">4 - やや高</option>
                                                            <option value="5">5 - 高</option>
                                                        </select>
                                                    </div>
                                                    <div style="display: flex; align-items: center; gap: 8px;">
                                                        <input type="checkbox" id="keyword3-active" checked>
                                                        <label for="keyword3-active" style="font-size: 14px;">有効</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                                <button class="daib-btn daib-btn-secondary" style="padding: 4px 8px; font-size: 12px;">
                                                    <i class="fas fa-grip-vertical"></i>
                                                </button>
                                                <button class="daib-btn daib-btn-danger" style="padding: 4px 8px; font-size: 12px;">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 一括操作 -->
                            <div class="content-card">
                                <h3 style="margin: 0 0 16px 0;">一括操作</h3>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px;">
                                    <div style="padding: 16px; border: 1px solid var(--daib-border); border-radius: 8px;">
                                        <h4 style="margin: 0 0 12px 0; font-weight: 600;">重要度一括設定</h4>
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <select id="bulk-importance" class="daib-input" style="flex: 1;">
                                                <option value="1">1 - 低</option>
                                                <option value="2">2 - やや低</option>
                                                <option value="3">3 - 中</option>
                                                <option value="4">4 - やや高</option>
                                                <option value="5">5 - 高</option>
                                            </select>
                                            <button onclick="bulkSetImportance()" class="daib-btn daib-btn-secondary">適用</button>
                                        </div>
                                    </div>
                                    <div style="padding: 16px; border: 1px solid var(--daib-border); border-radius: 8px;">
                                        <h4 style="margin: 0 0 12px 0; font-weight: 600;">状態一括設定</h4>
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <select id="bulk-status" class="daib-input" style="flex: 1;">
                                                <option value="active">有効</option>
                                                <option value="inactive">無効</option>
                                            </select>
                                            <button onclick="bulkSetStatus()" class="daib-btn daib-btn-secondary">適用</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 授業テーマ設定 -->
                    <div id="theme-setting-content" class="daib-content-section" style="display: none;">
                        <div class="daib-learning-content">
                            <!-- 説明 -->
                            <div class="content-card" style="margin-bottom: 24px;">
                                <h3 style="margin: 0 0 8px 0;">テーマ設定について</h3>
                                <p style="margin: 0; color: var(--daib-text-light);">
                                    授業を通しての大きなテーマを管理・編集できます。これらのテーマは最終回のアンケートで理解度評価に使用されます。
                                </p>
                                <div style="display: flex; gap: 12px; margin-top: 16px;">
                                    <button onclick="addNewTheme()" class="daib-btn daib-btn-primary">
                                        <i class="fas fa-plus"></i>
                                        新規テーマ
                                    </button>
                                    <button onclick="saveAllThemes()" class="daib-btn daib-btn-success">
                                        <i class="fas fa-save"></i>
                                        すべて保存
                                    </button>
                                </div>
                            </div>

                            <!-- フィルター -->
                            <div class="content-card" style="margin-bottom: 24px;">
                                <div style="display: flex; align-items: center; gap: 16px;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <i class="fas fa-search" style="color: var(--daib-text-light);"></i>
                                        <input
                                            type="text"
                                            id="theme-search-input"
                                            placeholder="テーマ名・説明で検索"
                                            class="daib-input"
                                            style="width: 250px;"
                                            oninput="filterThemes()"
                                        />
                                    </div>
                                    
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <i class="fas fa-filter" style="color: var(--daib-text-light);"></i>
                                        <select id="theme-status-filter" class="daib-input" onchange="filterThemes()">
                                            <option value="all">全ステータス</option>
                                            <option value="active">有効</option>
                                            <option value="inactive">無効</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- テーマ一覧 -->
                            <div class="content-card">
                                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                                    <h3 style="margin: 0;">
                                        テーマ一覧 (<span id="theme-count">3</span>件)
                                    </h3>
                                    <p style="margin: 0; font-size: 14px; color: var(--daib-text-light);">
                                        ドラッグ&ドロップで順序を変更できます
                                    </p>
                                </div>
                                
                                <div id="themes-list" style="max-height: 600px; overflow-y: auto;">
                                    <!-- テーマアイテム1 -->
                                    <div class="theme-item" style="border: 1px solid var(--daib-border); border-radius: 8px; padding: 16px; margin-bottom: 12px; background: var(--daib-surface);">
                                        <div style="display: flex; align-items: start; gap: 16px;">
                                            <div style="flex: 1;">
                                                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 16px; margin-bottom: 12px;">
                                                    <div>
                                                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">テーマ名</label>
                                                        <input type="text" value="データ分析の基礎" class="daib-input">
                                                    </div>
                                                    <div>
                                                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">カテゴリー</label>
                                                        <select class="daib-input">
                                                            <option value="foundation" selected>基礎</option>
                                                            <option value="application">応用</option>
                                                            <option value="practical">実践</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div style="margin-bottom: 12px;">
                                                    <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">説明</label>
                                                    <textarea class="daib-input" style="min-height: 60px;">データの収集、整理、分析の基本的な手法について学習します。統計的思考力を身につけることを目標とします。</textarea>
                                                </div>
                                                <div style="display: flex; gap: 16px; align-items: center;">
                                                    <div>
                                                        <label style="font-size: 12px; color: var(--daib-text-light);">重要度:</label>
                                                        <select class="daib-input" style="width: 100px; font-size: 14px;">
                                                            <option value="1">1 - 低</option>
                                                            <option value="2">2 - やや低</option>
                                                            <option value="3">3 - 中</option>
                                                            <option value="4">4 - やや高</option>
                                                            <option value="5" selected>5 - 高</option>
                                                        </select>
                                                    </div>
                                                    <div style="display: flex; align-items: center; gap: 8px;">
                                                        <input type="checkbox" id="theme1-active" checked>
                                                        <label for="theme1-active" style="font-size: 14px;">有効</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                                <button class="daib-btn daib-btn-secondary" style="padding: 4px 8px; font-size: 12px;">
                                                    <i class="fas fa-grip-vertical"></i>
                                                </button>
                                                <button class="daib-btn daib-btn-danger" style="padding: 4px 8px; font-size: 12px;">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- テーマアイテム2 -->
                                    <div class="theme-item" style="border: 1px solid var(--daib-border); border-radius: 8px; padding: 16px; margin-bottom: 12px; background: var(--daib-surface);">
                                        <div style="display: flex; align-items: start; gap: 16px;">
                                            <div style="flex: 1;">
                                                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 16px; margin-bottom: 12px;">
                                                    <div>
                                                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">テーマ名</label>
                                                        <input type="text" value="統計的推測と検定" class="daib-input">
                                                    </div>
                                                    <div>
                                                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">カテゴリー</label>
                                                        <select class="daib-input">
                                                            <option value="foundation">基礎</option>
                                                            <option value="application" selected>応用</option>
                                                            <option value="practical">実践</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div style="margin-bottom: 12px;">
                                                    <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">説明</label>
                                                    <textarea class="daib-input" style="min-height: 60px;">統計的仮説検定、信頼区間、推定などの統計的推測の手法について学習します。</textarea>
                                                </div>
                                                <div style="display: flex; gap: 16px; align-items: center;">
                                                    <div>
                                                        <label style="font-size: 12px; color: var(--daib-text-light);">重要度:</label>
                                                        <select class="daib-input" style="width: 100px; font-size: 14px;">
                                                            <option value="1">1 - 低</option>
                                                            <option value="2">2 - やや低</option>
                                                            <option value="3">3 - 中</option>
                                                            <option value="4" selected>4 - やや高</option>
                                                            <option value="5">5 - 高</option>
                                                        </select>
                                                    </div>
                                                    <div style="display: flex; align-items: center; gap: 8px;">
                                                        <input type="checkbox" id="theme2-active" checked>
                                                        <label for="theme2-active" style="font-size: 14px;">有効</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                                <button class="daib-btn daib-btn-secondary" style="padding: 4px 8px; font-size: 12px;">
                                                    <i class="fas fa-grip-vertical"></i>
                                                </button>
                                                <button class="daib-btn daib-btn-danger" style="padding: 4px 8px; font-size: 12px;">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- テーマアイテム3 -->
                                    <div class="theme-item" style="border: 1px solid var(--daib-border); border-radius: 8px; padding: 16px; margin-bottom: 12px; background: var(--daib-surface);">
                                        <div style="display: flex; align-items: start; gap: 16px;">
                                            <div style="flex: 1;">
                                                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 16px; margin-bottom: 12px;">
                                                    <div>
                                                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">テーマ名</label>
                                                        <input type="text" value="機械学習とデータマイニング" class="daib-input">
                                                    </div>
                                                    <div>
                                                        <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">カテゴリー</label>
                                                        <select class="daib-input">
                                                            <option value="foundation">基礎</option>
                                                            <option value="application">応用</option>
                                                            <option value="practical" selected>実践</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div style="margin-bottom: 12px;">
                                                    <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">説明</label>
                                                    <textarea class="daib-input" style="min-height: 60px;">機械学習アルゴリズム、パターン認識、データマイニング手法の理論と実装について学習します。</textarea>
                                                </div>
                                                <div style="display: flex; gap: 16px; align-items: center;">
                                                    <div>
                                                        <label style="font-size: 12px; color: var(--daib-text-light);">重要度:</label>
                                                        <select class="daib-input" style="width: 100px; font-size: 14px;">
                                                            <option value="1">1 - 低</option>
                                                            <option value="2">2 - やや低</option>
                                                            <option value="3" selected>3 - 中</option>
                                                            <option value="4">4 - やや高</option>
                                                            <option value="5">5 - 高</option>
                                                        </select>
                                                    </div>
                                                    <div style="display: flex; align-items: center; gap: 8px;">
                                                        <input type="checkbox" id="theme3-active" checked>
                                                        <label for="theme3-active" style="font-size: 14px;">有効</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                                <button class="daib-btn daib-btn-secondary" style="padding: 4px 8px; font-size: 12px;">
                                                    <i class="fas fa-grip-vertical"></i>
                                                </button>
                                                <button class="daib-btn daib-btn-danger" style="padding: 4px 8px; font-size: 12px;">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="empty-theme-state" style="display: none; text-align: center; padding: 40px;">
                                    <i class="fas fa-brain" style="font-size: 48px; color: var(--daib-border); margin-bottom: 16px;"></i>
                                    <h3 style="margin: 0 0 8px 0; color: var(--daib-text);">テーマが見つかりません</h3>
                                    <p style="margin: 0; color: var(--daib-text-light);">
                                        フィルター条件を変更するか、新しいテーマを作成してください。
                                    </p>
                                </div>
                            </div>

                            <!-- ヘルプ -->
                            <div class="content-card" style="background: rgba(2, 132, 199, 0.05); border: 1px solid rgba(2, 132, 199, 0.2); margin-top: 24px;">
                                <div style="display: flex; align-items: flex-start; gap: 16px;">
                                    <i class="fas fa-info-circle" style="color: var(--daib-info); font-size: 24px; margin-top: 4px;"></i>
                                    <div>
                                        <h4 style="margin: 0 0 8px 0; color: var(--daib-info);">テーマ設定について</h4>
                                        <div style="font-size: 14px; color: var(--daib-info); line-height: 1.5;">
                                            <p style="margin: 0 0 8px 0;">• テーマは授業を通しての大きな学習目標を表します</p>
                                            <p style="margin: 0 0 8px 0;">• 最終回のアンケートでこれらのテーマについて理解度を評価します</p>
                                            <p style="margin: 0 0 8px 0;">• 順序はテーマの重要度や教育課程での出現順序を表します</p>
                                            <p style="margin: 0;">• 無効にしたテーマは最終回アンケートから除外されます</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 個別問題生成 -->
                    <div id="problem-generation-content" class="daib-content-section" style="display: none;">
                        <div class="daib-learning-content">
                            <!-- 説明 -->
                            <div class="content-card" style="margin-bottom: 24px;">
                                <h3 style="margin: 0 0 8px 0;">個別問題生成について</h3>
                                <p style="margin: 0 0 12px 0; color: var(--daib-text-light);">
                                    AIが作成した問題の管理や、教員独自の問題作成・編集ができます。問題の難易度設定も可能です。
                                </p>
                                <div style="display: flex; gap: 12px; margin-top: 16px;">
                                    <button onclick="showProblemSection('browse')" class="daib-btn daib-btn-primary">
                                        <i class="fas fa-eye"></i>
                                        問題閲覧・編集
                                    </button>
                                    <button onclick="showProblemSection('create')" class="daib-btn daib-btn-success">
                                        <i class="fas fa-plus"></i>
                                        新規問題作成
                                    </button>
                                    <button onclick="showProblemSection('csv')" class="daib-btn daib-btn-info">
                                        <i class="fas fa-file-csv"></i>
                                        CSV管理
                                    </button>
                                    <button onclick="showProblemSection('difficulty')" class="daib-btn daib-btn-warning">
                                        <i class="fas fa-star"></i>
                                        難易度設定
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 問題閲覧・編集セクション -->
                            <div id="browse-section" class="problem-section">
                                <div class="content-card">
                                    <h3 style="margin: 0 0 16px 0;">AI生成問題の閲覧・編集</h3>
                                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <i class="fas fa-filter" style="color: var(--daib-text-light);"></i>
                                            <select class="daib-input" onchange="filterProblems()">
                                                <option value="all">全問題</option>
                                                <option value="calculation">計算問題</option>
                                                <option value="choice">選択問題</option>
                                                <option value="text">記述問題</option>
                                            </select>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <i class="fas fa-search" style="color: var(--daib-text-light);"></i>
                                            <input type="text" placeholder="問題内容で検索" class="daib-input" style="width: 250px;">
                                        </div>
                                    </div>
                                    
                                    <div id="problems-list" style="max-height: 600px; overflow-y: auto;">
                                        <!-- サンプル問題 -->
                                        <div class="problem-item" style="border: 1px solid var(--daib-border); border-radius: 8px; padding: 16px; margin-bottom: 16px; background: var(--daib-surface);">
                                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                                <div>
                                                    <span style="padding: 4px 8px; background: #e6f3ff; color: #0369a1; border-radius: 12px; font-size: 12px; margin-right: 8px;">計算問題</span>
                                                    <span style="padding: 4px 8px; background: #f0fdf4; color: #047857; border-radius: 12px; font-size: 12px;">難易度: 中</span>
                                                </div>
                                                <div style="display: flex; gap: 8px;">
                                                    <button class="daib-btn daib-btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="editProblem(1)">
                                                        <i class="fas fa-edit"></i> 編集
                                                    </button>
                                                    <button class="daib-btn daib-btn-danger" style="padding: 4px 8px; font-size: 12px;" onclick="deleteProblem(1)">
                                                        <i class="fas fa-trash"></i> 削除
                                                    </button>
                                                </div>
                                            </div>
                                            <div style="margin-bottom: 12px;">
                                                <h4 style="margin: 0 0 8px 0; font-size: 16px;">問題文</h4>
                                                <p style="margin: 0; line-height: 1.5;">2×2分割表において、感度が0.8、特異度が0.9の場合、陽性的中率を求めなさい。ただし、有病率は0.1とする。</p>
                                            </div>
                                            <div style="margin-bottom: 12px;">
                                                <h4 style="margin: 0 0 8px 0; font-size: 16px;">解答</h4>
                                                <p style="margin: 0; color: var(--daib-success);">0.47 (または47%)</p>
                                            </div>
                                            <div>
                                                <h4 style="margin: 0 0 8px 0; font-size: 16px;">解説</h4>
                                                <p style="margin: 0; font-size: 14px; color: var(--daib-text-light);">陽性的中率 = (感度×有病率) / (感度×有病率 + (1-特異度)×(1-有病率))</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 新規問題作成セクション -->
                            <div id="create-section" class="problem-section" style="display: none;">
                                <div class="content-card">
                                    <h3 style="margin: 0 0 16px 0;">新規問題作成</h3>
                                    <form id="new-problem-form">
                                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 16px; margin-bottom: 16px;">
                                            <div>
                                                <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">問題タイプ</label>
                                                <select class="daib-input" name="problemType" onchange="updateProblemForm()">
                                                    <option value="calculation">計算問題</option>
                                                    <option value="choice">選択問題</option>
                                                    <option value="text">記述問題</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">難易度</label>
                                                <select class="daib-input" name="difficulty">
                                                    <option value="easy">低</option>
                                                    <option value="medium">中</option>
                                                    <option value="hard">高</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div style="margin-bottom: 16px;">
                                            <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">問題文</label>
                                            <textarea class="daib-input" name="question" style="min-height: 120px;" placeholder="問題文を入力してください"></textarea>
                                        </div>
                                        <div id="answer-section" style="margin-bottom: 16px;">
                                            <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">解答</label>
                                            <input type="text" class="daib-input" name="answer" placeholder="正解を入力してください">
                                        </div>
                                        <div style="margin-bottom: 16px;">
                                            <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">解説</label>
                                            <textarea class="daib-input" name="explanation" style="min-height: 80px;" placeholder="解説を入力してください"></textarea>
                                        </div>
                                        <div style="display: flex; gap: 12px;">
                                            <button type="button" onclick="saveProblem()" class="daib-btn daib-btn-primary">
                                                <i class="fas fa-save"></i> 保存
                                            </button>
                                            <button type="button" onclick="previewProblem()" class="daib-btn daib-btn-secondary">
                                                <i class="fas fa-eye"></i> プレビュー
                                            </button>
                                            <button type="button" onclick="clearForm()" class="daib-btn daib-btn-danger">
                                                <i class="fas fa-times"></i> クリア
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            
                            <!-- CSV管理セクション -->
                            <div id="csv-section" class="problem-section" style="display: none;">
                                <div class="content-card" style="margin-bottom: 24px;">
                                    <h3 style="margin: 0 0 16px 0;">CSV一括管理</h3>
                                    <div style="display: flex; gap: 12px; margin-bottom: 20px;">
                                        <button onclick="exportCSV()" class="daib-btn daib-btn-primary">
                                            <i class="fas fa-download"></i> CSVエクスポート
                                        </button>
                                        <div style="position: relative;">
                                            <input type="file" id="csv-file-input" accept=".csv" style="display: none;" onchange="importCSV()">
                                            <button onclick="document.getElementById('csv-file-input').click()" class="daib-btn daib-btn-success">
                                                <i class="fas fa-upload"></i> CSVインポート
                                            </button>
                                        </div>
                                        <button onclick="downloadTemplate()" class="daib-btn daib-btn-info">
                                            <i class="fas fa-file-download"></i> テンプレートDL
                                        </button>
                                    </div>
                                    <div style="padding: 12px; background: #f0f9ff; border: 1px solid #0284c7; border-radius: 6px; font-size: 14px;">
                                        <h4 style="margin: 0 0 8px 0; color: #0284c7;">CSV形式について</h4>
                                        <p style="margin: 0; color: #0284c7;">列順序: 問題タイプ, 問題文, 解答, 解説, 難易度</p>
                                    </div>
                                </div>
                                
                                <div class="content-card">
                                    <h3 style="margin: 0 0 16px 0;">CSV一括アップロード</h3>
                                    <div style="border: 2px dashed var(--daib-border); border-radius: 8px; padding: 32px; text-align: center; margin-bottom: 20px;">
                                        <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: var(--daib-text-light); margin-bottom: 16px;"></i>
                                        <p style="margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">CSVファイルをドラッグ&ドロップ</p>
                                        <p style="margin: 0; color: var(--daib-text-light);">または</p>
                                        <button onclick="document.getElementById('bulk-csv-input').click()" class="daib-btn daib-btn-primary" style="margin-top: 12px;">
                                            ファイルを選択
                                        </button>
                                        <input type="file" id="bulk-csv-input" accept=".csv" style="display: none;" onchange="handleBulkCSV()">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 難易度設定セクション -->
                            <div id="difficulty-section" class="problem-section" style="display: none;">
                                <div class="content-card" style="margin-bottom: 24px;">
                                    <h3 style="margin: 0 0 16px 0;">難易度設定</h3>
                                    <div style="display: flex; gap: 12px; margin-bottom: 20px;">
                                        <button onclick="showDifficultyMode('individual')" class="daib-btn daib-btn-primary">
                                            <i class="fas fa-edit"></i> 個別設定
                                        </button>
                                        <button onclick="showDifficultyMode('bulk')" class="daib-btn daib-btn-success">
                                            <i class="fas fa-file-csv"></i> CSV一括設定
                                        </button>
                                        <button onclick="exportDifficultyCSV()" class="daib-btn daib-btn-info">
                                            <i class="fas fa-download"></i> 難易度CSV出力
                                        </button>
                                    </div>
                                    
                                    <!-- 個別難易度設定 -->
                                    <div id="individual-difficulty" class="difficulty-mode">
                                        <div class="content-card">
                                            <h4 style="margin: 0 0 16px 0;">問題別難易度設定</h4>
                                            <div style="border: 1px solid var(--daib-border); border-radius: 8px; padding: 16px; margin-bottom: 12px; background: var(--daib-surface);">
                                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                                    <div style="flex: 1;">
                                                        <h5 style="margin: 0 0 4px 0;">問題1: 2×2分割表の感度計算</h5>
                                                        <p style="margin: 0; font-size: 14px; color: var(--daib-text-light);">現在の難易度: 中</p>
                                                    </div>
                                                    <div style="display: flex; align-items: center; gap: 12px;">
                                                        <select class="daib-input" style="width: 120px;">
                                                            <option value="easy">低</option>
                                                            <option value="medium" selected>中</option>
                                                            <option value="hard">高</option>
                                                        </select>
                                                        <button class="daib-btn daib-btn-primary" style="padding: 6px 12px; font-size: 12px;">
                                                            更新
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- CSV一括難易度設定 -->
                                    <div id="bulk-difficulty" class="difficulty-mode" style="display: none;">
                                        <div class="content-card">
                                            <h4 style="margin: 0 0 16px 0;">CSV一括難易度設定</h4>
                                            <div style="border: 2px dashed var(--daib-border); border-radius: 8px; padding: 32px; text-align: center;">
                                                <i class="fas fa-star" style="font-size: 48px; color: var(--daib-warning); margin-bottom: 16px;"></i>
                                                <p style="margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">難易度設定CSVをアップロード</p>
                                                <p style="margin: 0; color: var(--daib-text-light);">形式: 問題ID, 難易度</p>
                                                <button onclick="document.getElementById('difficulty-csv-input').click()" class="daib-btn daib-btn-warning" style="margin-top: 12px;">
                                                    ファイルを選択
                                                </button>
                                                <input type="file" id="difficulty-csv-input" accept=".csv" style="display: none;" onchange="handleDifficultyCSV()">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../common/data.js"></script>
    <script>
        // 教員用状態管理
        const TEACHER_STATE = {
            currentMode: 'review', // 'daib' or 'review'
            currentDAIBFunction: 'upload', // 'upload', 'keywords', 'problems', 'search', 'chat'
            currentReviewFunction: 'dashboard', // 'dashboard', 'keyword-management', 'theme-setting', 'problem-generation'
            currentSubject: 'data-science',
            currentWeek: 7,
            currentChatType: 'general', // 'general', 'data-science', 'data-overview'
            
            setMode: function(mode, func) {
                console.log('=== setMode called ===');
                console.log('Parameters:', mode, func);
                console.log('Before - currentMode:', this.currentMode, 'currentDAIBFunction:', this.currentDAIBFunction);
                
                // チャット系の場合は特別処理
                if (mode === 'chat') {
                    this.currentMode = 'daib';
                    this.currentDAIBFunction = 'chat';
                    this.currentChatType = func;
                    this.updateChatFunction('chat');
                } else {
                    this.currentMode = mode;
                    if (mode === 'daib') {
                        this.currentDAIBFunction = func;
                        if (func !== 'upload') {
                            this.updateChatFunction(func);
                        }
                    } else {
                        this.currentReviewFunction = func;
                        this.updateReviewPageTitle(func);
                    }
                }
                console.log('After - currentMode:', this.currentMode, 'currentDAIBFunction:', this.currentDAIBFunction, 'currentChatType:', this.currentChatType);
                this.updateUI();
            },
            
            updateChatFunction: function(func) {
                console.log('updateChatFunction called with:', func);
                const titleElement = document.getElementById('chat-function-title');
                const subtitleElement = document.getElementById('chat-function-subtitle');
                
                console.log('Title element found:', !!titleElement);
                console.log('Subtitle element found:', !!subtitleElement);
                
                // 要素が存在しない場合は処理をスキップ
                if (!titleElement || !subtitleElement) {
                    console.warn('Chat function title/subtitle elements not found, skipping update');
                    return;
                }
                
                switch(func) {
                    case 'keywords':
                        titleElement.textContent = 'キーワード解説';
                        subtitleElement.textContent = '授業資料からキーワードを抽出・管理';
                        break;
                    case 'problems':
                        titleElement.textContent = '設問作成';
                        subtitleElement.textContent = 'キーワードベースの問題を自動生成';
                        break;
                    case 'search':
                        titleElement.textContent = '動画検索';
                        subtitleElement.textContent = '講義動画をキーワードで検索';
                        break;
                    case 'chat':
                        switch(this.currentChatType) {
                            case 'general':
                                titleElement.textContent = 'DAIBチャット';
                                subtitleElement.textContent = '汎用的な質問・相談';
                                break;
                            case 'data-science':
                                titleElement.textContent = 'データサイエンス基礎';
                                subtitleElement.textContent = 'データサイエンス基礎に関する質問';
                                break;
                            case 'data-overview':
                                titleElement.textContent = 'データサイエンス概論';
                                subtitleElement.textContent = 'データサイエンス概論に関する質問';
                                break;
                        }
                        break;
                }
                console.log('Chat function updated successfully');
            },
            
            updateReviewPageTitle: function(func) {
                console.log('updateReviewPageTitle called with:', func);
                const titleElement = document.getElementById('review-page-title');
                const actionsElement = document.getElementById('review-actions');
                
                console.log('Review title element found:', !!titleElement);
                console.log('Review actions element found:', !!actionsElement);
                
                // 要素が存在しない場合は処理をスキップ
                if (!titleElement || !actionsElement) {
                    console.warn('Review page title/actions elements not found, skipping update');
                    return;
                }
                
                switch(func) {
                    case 'dashboard':
                        titleElement.textContent = '教員ダッシュボード';
                        actionsElement.innerHTML = `
                            <button onclick="generateReport()" class="daib-btn daib-btn-primary">
                                <i class="fas fa-download"></i>
                                レポート生成
                            </button>
                        `;
                        break;
                    case 'keyword-management':
                        titleElement.textContent = '授業回キーワード管理';
                        actionsElement.innerHTML = `
                            <button onclick="addNewKeyword()" class="daib-btn daib-btn-success" style="margin-right: 12px;">
                                <i class="fas fa-plus"></i>
                                新規キーワード追加
                            </button>
                            <button onclick="saveAllKeywords()" class="daib-btn daib-btn-primary">
                                <i class="fas fa-save"></i>
                                すべて保存
                            </button>
                        `;
                        break;
                    case 'theme-setting':
                        titleElement.textContent = '授業テーマ設定';
                        actionsElement.innerHTML = `
                            <button onclick="addNewTheme()" class="daib-btn daib-btn-primary" style="margin-right: 12px;">
                                <i class="fas fa-plus"></i>
                                新規テーマ
                            </button>
                            <button onclick="saveAllThemes()" class="daib-btn daib-btn-success">
                                <i class="fas fa-save"></i>
                                すべて保存
                            </button>
                        `;
                        break;
                }
                console.log('Review page title updated successfully');
            },
            
            updateUI: function() {
                console.log('=== updateUI called ===');
                console.log('Current mode:', this.currentMode, 'DAIB function:', this.currentDAIBFunction);
                
                // メニューの表示切り替え
                this.updateMenuUI();
                
                // コンテンツエリアの表示切り替え
                const daibArea = document.getElementById('daib-area');
                const reviewArea = document.getElementById('review-area');
                
                console.log('DOM elements - daibArea:', !!daibArea, 'reviewArea:', !!reviewArea);
                
                if (this.currentMode === 'daib') {
                    console.log('Switching to DAIB mode');
                    if (daibArea) daibArea.style.display = 'block';
                    if (reviewArea) reviewArea.style.display = 'none';
                    this.showDAIBContent();
                } else {
                    console.log('Switching to Review mode');
                    if (daibArea) daibArea.style.display = 'none';
                    if (reviewArea) reviewArea.style.display = 'block';
                    this.showReviewContent();
                }
                
                // ナビゲーションのアクティブ状態更新
                this.updateNavigation();
                console.log('=== updateUI completed ===');
            },
            
            updateMenuUI: function() {
                // メニュートグルボタンの状態更新
                document.querySelectorAll('.menu-toggle-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                const activeToggle = document.getElementById(
                    this.currentMode === 'daib' ? 'daib-learning-toggle' : 'learning-review-toggle'
                );
                if (activeToggle) {
                    activeToggle.classList.add('active');
                }
                
                // メニューコンテンツの表示切り替え
                document.querySelectorAll('.menu-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                const activeMenu = document.getElementById(
                    this.currentMode === 'daib' ? 'daib-learning-menu' : 'learning-review-menu'
                );
                if (activeMenu) {
                    activeMenu.classList.add('active');
                }
            },
            
            showDAIBContent: function() {
                console.log('=== showDAIBContent called ===');
                console.log('Function:', this.currentDAIBFunction, 'ChatType:', this.currentChatType);
                
                // DAIBモードでのコンテンツ表示制御
                const chatArea = document.querySelector('#daib-area .daib-chat-area');
                const uploadContent = document.getElementById('upload-content');
                const rightMenu = document.getElementById('chat-right-menu');
                
                console.log('Elements found:');
                console.log('- chatArea:', !!chatArea, chatArea ? 'exists' : 'missing');
                console.log('- uploadContent:', !!uploadContent, uploadContent ? 'exists' : 'missing');
                console.log('- rightMenu:', !!rightMenu, rightMenu ? 'exists' : 'missing');
                
                if (this.currentDAIBFunction === 'upload') {
                    // アップロード機能の場合
                    console.log('>>> Switching to UPLOAD mode');
                    if (chatArea) {
                        chatArea.style.display = 'none';
                        console.log('- Hidden chat area');
                    }
                    if (uploadContent) {
                        uploadContent.style.display = 'block';
                        console.log('- Shown upload content');
                    } else {
                        console.error('- Upload content element not found!');
                    }
                    if (rightMenu) {
                        rightMenu.style.display = 'none';
                        console.log('- Hidden right menu');
                    }
                } else {
                    // チャット機能の場合
                    console.log('>>> Switching to CHAT mode');
                    if (chatArea) {
                        chatArea.style.display = 'flex';
                        console.log('- Shown chat area');
                    } else {
                        console.error('- Chat area element not found!');
                    }
                    if (uploadContent) {
                        uploadContent.style.display = 'none';
                        console.log('- Hidden upload content');
                    }
                    
                    // 右サイドバーの表示制御
                    if (this.currentDAIBFunction === 'chat' && this.currentChatType === 'general') {
                        console.log('>>> General chat mode - hiding right menu');
                        if (rightMenu) rightMenu.style.display = 'none';
                    } else if (this.currentDAIBFunction === 'chat') {
                        console.log('>>> Subject chat mode - showing right menu');
                        if (rightMenu) rightMenu.style.display = 'block';
                    } else {
                        console.log('>>> Other mode - hiding right menu');
                        if (rightMenu) rightMenu.style.display = 'none';
                    }
                    
                    // チャットコンテンツの表示切り替え
                    document.querySelectorAll('.chat-content').forEach(content => {
                        content.style.display = 'none';
                    });
                    
                    if (this.currentDAIBFunction === 'chat') {
                        const chatContentId = this.currentChatType === 'general' ? 'general-chat' : 
                                            this.currentChatType === 'data-science' ? 'data-science-chat' : 'data-overview-chat';
                        console.log('Showing chat content:', chatContentId);
                        const chatContent = document.getElementById(chatContentId);
                        if (chatContent) {
                            chatContent.style.display = 'block';
                            console.log('- Successfully shown chat content:', chatContentId);
                        } else {
                            console.error('- Chat content element not found:', chatContentId);
                        }
                    }
                }
                console.log('=== showDAIBContent completed ===');
            },
            
            showReviewContent: function() {
                // すべての振り返りコンテンツを非表示
                document.querySelectorAll('#review-area .daib-content-section').forEach(section => {
                    section.style.display = 'none';
                });
                
                // 現在の機能のコンテンツを表示
                const currentContent = document.getElementById(this.currentReviewFunction + '-content');
                if (currentContent) {
                    currentContent.style.display = 'block';
                }
            },
            
            updateNavigation: function() {
                // すべてのナビゲーション項目からアクティブクラスを削除
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // 現在のモードに応じてアクティブ項目を設定
                let selector;
                if (this.currentMode === 'daib') {
                    if (this.currentDAIBFunction === 'chat') {
                        // チャット系の場合
                        selector = `[onclick="TEACHER_STATE.setMode('chat', '${this.currentChatType}')"]`;
                    } else {
                        // 通常のDAIB機能の場合
                        selector = `[onclick="TEACHER_STATE.setMode('daib', '${this.currentDAIBFunction}')"]`;
                    }
                } else {
                    // 授業振り返りの場合
                    selector = `[onclick="TEACHER_STATE.setMode('review', '${this.currentReviewFunction}')"]`;
                }
                    
                const currentNavItem = document.querySelector(selector);
                if (currentNavItem) {
                    currentNavItem.classList.add('active');
                }
                
                // 右サイドバーのアクティブ状態も更新（DAIB学習モードの場合）
                if (this.currentMode === 'daib' && this.currentDAIBFunction !== 'upload' && this.currentDAIBFunction !== 'chat') {
                    const sidebarItems = document.querySelectorAll('.daib-chat-sidebar .nav-item');
                    sidebarItems.forEach(item => item.classList.remove('active'));
                    
                    const sidebarSelector = `[onclick="TEACHER_STATE.setMode('daib', '${this.currentDAIBFunction}')"]`;
                    const activeSidebarItem = document.querySelector('.daib-chat-sidebar ' + sidebarSelector);
                    if (activeSidebarItem) {
                        activeSidebarItem.classList.add('active');
                    }
                }
            }
        };

        // メニュー切り替え関数
        function toggleMenuMode(mode) {
            console.log('=== toggleMenuMode called ===');
            console.log('Mode parameter:', mode);
            if (mode === 'learning') {
                console.log('Switching to DAIB learning mode');
                TEACHER_STATE.setMode('daib', 'upload');
            } else {
                console.log('Switching to review mode');
                TEACHER_STATE.setMode('review', 'dashboard');
            }
            console.log('=== toggleMenuMode completed ===');
        }

        // 機能別関数
        function uploadFiles() {
            alert('ファイルアップロード機能を実装予定');
        }

        function generateReport() {
            alert('レポート生成機能を実装予定');
        }

        function sendMessage(type) {
            let input, message;
            if (type === 'data-science') {
                input = document.getElementById('chat-input-ds');
            } else if (type === 'data-overview') {
                input = document.getElementById('chat-input-do');
            } else {
                input = document.getElementById('chat-input');
            }
            
            message = input.value.trim();
            if (message) {
                // チャットメッセージ送信処理
                alert('チャット機能は実装予定です: ' + message);
                input.value = '';
            }
        }

        function changeChatWeek() {
            const select = document.getElementById('chat-week-select');
            console.log('Chat week changed to:', select.value);
            // 週選択に応じたコンテンツ更新処理
        }

        function showChatFeature(feature) {
            const contentId = TEACHER_STATE.currentChatType === 'data-science' ? 
                             'chat-feature-content' : 'chat-feature-content-overview';
            const container = document.getElementById(contentId);
            
            // 機能別のコンテンツを表示
            const featureContent = {
                'fill-blank': {
                    title: '穴埋め式問題作成',
                    icon: 'fas fa-edit',
                    content: '穴埋め式問題の作成機能です。キーワードを基に自動生成します。'
                },
                'multiple-choice': {
                    title: '選択式問題作成',
                    icon: 'fas fa-list-ul',
                    content: '選択式問題の作成機能です。'
                },
                'free-response': {
                    title: '自由記述式問題作成',
                    icon: 'fas fa-pen',
                    content: '自由記述式問題の作成機能です。'
                },
                'keyword-analysis': {
                    title: '2×2分割表の指標',
                    icon: 'fas fa-table',
                    content: '2×2分割表の指標に関する詳細な解説と教材を提供します。'
                },
                'keyword-risk': {
                    title: 'リスク差・リスク比・オッズ比',
                    icon: 'fas fa-balance-scale',
                    content: 'リスク差・リスク比・オッズ比の解説と計算方法を提供します。'
                },
                'keyword-matrix': {
                    title: '混同行列とは',
                    icon: 'fas fa-th',
                    content: '混同行列の概念と活用方法について解説します。'
                },
                'keyword-regression': {
                    title: '回帰分析の目的',
                    icon: 'fas fa-chart-line',
                    content: '回帰分析の目的と手法について詳しく解説します。'
                },
                'keyword-model': {
                    title: '単回帰モデルとは',
                    icon: 'fas fa-function',
                    content: '単回帰モデルの基本概念と実装方法を説明します。'
                },
                'video-search': {
                    title: '動画検索',
                    icon: 'fas fa-video',
                    content: '講義動画をキーワードで検索できます。'
                },
                'slide-create': {
                    title: 'スライド作成',
                    icon: 'fas fa-presentation',
                    content: '授業スライドを自動生成します。テーマやキーワードを指定してください。'
                }
            };
            
            if (featureContent[feature]) {
                const content = featureContent[feature];
                container.innerHTML = `
                    <div style="padding: 20px; border: 1px solid var(--daib-border); border-radius: 8px; background: white; margin: 16px 0;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                            <div style="width: 32px; height: 32px; background: var(--daib-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="${content.icon}" style="color: white; font-size: 14px;"></i>
                            </div>
                            <h4 style="margin: 0; color: var(--daib-primary);">${content.title}</h4>
                        </div>
                        <p style="margin: 0; line-height: 1.6;">${content.content}</p>
                        <div style="margin-top: 16px;">
                            <button class="daib-btn daib-btn-primary" onclick="alert('${content.title}機能は実装予定です')">
                                開始する
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        function changeReviewSubject() {
            const select = document.getElementById('review-subject-select');
            TEACHER_STATE.currentSubject = select.value;
            // データ更新処理
            console.log('Subject changed to:', select.value);
        }

        function changeReviewWeek() {
            const select = document.getElementById('review-week-select');
            TEACHER_STATE.currentWeek = parseInt(select.value);
            // データ更新処理
            console.log('Week changed to:', select.value);
        }

        // キーワード管理関数
        function addNewKeyword() {
            alert('新規キーワード追加機能を実装予定');
        }

        function saveAllKeywords() {
            alert('キーワード保存機能を実装予定');
        }

        function sortKeywords() {
            const select = document.getElementById('sort-select');
            alert('キーワードソート機能を実装予定: ' + select.value);
        }

        function resetKeywords() {
            alert('キーワードリセット機能を実装予定');
        }

        function bulkSetImportance() {
            const select = document.getElementById('bulk-importance');
            alert('一括重要度設定機能を実装予定: ' + select.value);
        }

        function bulkSetStatus() {
            const select = document.getElementById('bulk-status');
            alert('一括状態設定機能を実装予定: ' + select.value);
        }

        // テーマ設定関数
        function addNewTheme() {
            alert('新規テーマ追加機能を実装予定');
        }

        function saveAllThemes() {
            alert('テーマ保存機能を実装予定');
        }

        function filterThemes() {
            const searchInput = document.getElementById('theme-search-input');
            const statusFilter = document.getElementById('theme-status-filter');
            alert('テーマフィルター機能を実装予定');
        }

        // 個別問題生成機能
        function showProblemSection(section) {
            // 全セクションを非表示
            document.querySelectorAll('.problem-section').forEach(el => {
                el.style.display = 'none';
            });
            
            // 選択されたセクションを表示
            document.getElementById(section + '-section').style.display = 'block';
        }

        function editProblem(id) {
            alert(`問題${id}の編集機能を実装予定`);
        }

        function deleteProblem(id) {
            if (confirm(`問題${id}を削除しますか？`)) {
                alert(`問題${id}を削除しました`);
            }
        }

        function filterProblems() {
            alert('問題フィルター機能を実装予定');
        }

        function updateProblemForm() {
            const problemType = document.querySelector('[name="problemType"]').value;
            const answerSection = document.getElementById('answer-section');
            
            if (problemType === 'choice') {
                answerSection.innerHTML = `
                    <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">選択肢</label>
                    <div style="display: grid; gap: 8px;">
                        <input type="text" class="daib-input" placeholder="A) 選択肢1" name="choice1">
                        <input type="text" class="daib-input" placeholder="B) 選択肢2" name="choice2">
                        <input type="text" class="daib-input" placeholder="C) 選択肢3" name="choice3">
                        <input type="text" class="daib-input" placeholder="D) 選択肢4" name="choice4">
                    </div>
                    <label style="display: block; font-size: 12px; font-weight: 600; margin: 12px 0 4px 0;">正解</label>
                    <select class="daib-input" name="correctAnswer">
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                    </select>
                `;
            } else {
                answerSection.innerHTML = `
                    <label style="display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px;">解答</label>
                    <input type="text" class="daib-input" name="answer" placeholder="正解を入力してください">
                `;
            }
        }

        function saveProblem() {
            alert('問題保存機能を実装予定');
        }

        function previewProblem() {
            alert('問題プレビュー機能を実装予定');
        }

        function clearForm() {
            document.getElementById('new-problem-form').reset();
            updateProblemForm();
        }

        function exportCSV() {
            alert('CSVエクスポート機能を実装予定');
        }

        function importCSV() {
            alert('CSVインポート機能を実装予定');
        }

        function downloadTemplate() {
            alert('テンプレートダウンロード機能を実装予定');
        }

        function handleBulkCSV() {
            alert('CSV一括アップロード機能を実装予定');
        }

        function confirmCSVImport() {
            alert('CSVインポート確認機能を実装予定');
        }

        function cancelCSVImport() {
            document.getElementById('csv-preview').style.display = 'none';
        }

        function showDifficultyMode(mode) {
            document.querySelectorAll('.difficulty-mode').forEach(el => {
                el.style.display = 'none';
            });
            document.getElementById(mode + '-difficulty').style.display = 'block';
        }

        function exportDifficultyCSV() {
            alert('難易度CSV出力機能を実装予定');
        }

        function handleDifficultyCSV() {
            alert('難易度CSV処理機能を実装予定');
        }

        // タブ初期化
        function initializeTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabName = button.dataset.tab;
                    
                    // 全タブボタンから active スタイルを削除
                    tabButtons.forEach(btn => {
                        btn.style.borderBottom = '3px solid transparent';
                        btn.style.color = 'var(--daib-text-light)';
                    });
                    
                    // 全タブコンテンツを非表示
                    tabContents.forEach(content => content.style.display = 'none');
                    
                    // クリックされたタブボタンをアクティブに
                    button.style.borderBottom = '3px solid var(--daib-primary)';
                    button.style.color = 'var(--daib-primary)';
                    
                    // 対応するタブコンテンツを表示
                    document.getElementById(tabName + '-tab').style.display = 'block';
                });
            });
        }

        // ダッシュボードデータ読み込み
        function loadDashboardData() {
            // キーワード理解度リスト生成
            const keywordList = document.getElementById('keyword-understanding-list');
            const keywordData = [
                { name: "2×2分割表の指標", understanding: 2.1 },
                { name: "リスク差・リスク比・オッズ比", understanding: 3.4 },
                { name: "混同行列とは", understanding: 3.8 },
                { name: "回帰分析の目的", understanding: 4.2 },
                { name: "単回帰モデルとは", understanding: 3.9 },
                { name: "最小二乗法による回帰係数の推定", understanding: 3.6 },
                { name: "決定係数の解釈", understanding: 4.6 },
                { name: "Rを用いた回帰分析", understanding: 3.7 }
            ];
            
            keywordData.forEach((keyword, index) => {
                const item = document.createElement('div');
                item.style.cssText = 'display: flex; align-items: center; justify-content: space-between; padding: 12px; margin-bottom: 8px; background: var(--daib-background); border-radius: 8px;';
                item.innerHTML = `
                    <div>
                        <p style="margin: 0; font-weight: 600; color: var(--daib-text);">${keyword.name}</p>
                        <p style="margin: 0; font-size: 12px; color: var(--daib-text-light);">第7回のキーワード</p>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 14px; font-weight: 600;">${keyword.understanding.toFixed(1)}</span>
                        <div style="width: 80px; height: 8px; background: var(--daib-border); border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; border-radius: 4px; width: ${(keyword.understanding / 5) * 100}%; background: ${getUnderstandingColor(keyword.understanding)};"></div>
                        </div>
                    </div>
                `;
                keywordList.appendChild(item);
            });

            // ヒートマップ生成
            generateHeatmap();
        }

        // 理解度に応じた色を取得
        function getUnderstandingColor(level) {
            if (level >= 4.0) return 'var(--daib-success)';
            if (level >= 3.5) return 'var(--daib-info)';
            if (level >= 2.5) return 'var(--daib-warning)';
            return 'var(--daib-error)';
        }

        // ヒートマップ生成
        function generateHeatmap() {
            const container = document.getElementById('heatmap-container');
            
            // データサイエンス基礎を受講する主要学部データ
            const departments = [
                '理工学部', '経済学部', '商学部', '文化情報学部'
            ];
            
            const keywords = [
                "2×2分割表の指標", "リスク差・リスク比・オッズ比", "混同行列とは", "回帰分析の目的",
                "単回帰モデルとは", "最小二乗法による回帰係数の推定", "決定係数の解釈", "Rを用いた回帰分析"
            ];
            
            // ヘッダー行
            const header = document.createElement('div');
            header.style.cssText = 'display: grid; gap: 2px; margin-bottom: 8px; grid-template-columns: 120px ' + 'repeat(' + keywords.length + ', minmax(100px, 1fr));';
            header.innerHTML = `
                <div style="padding: 8px; font-size: 12px; font-weight: 600; color: var(--daib-text-light);">学部</div>
                ${keywords.map(keyword => 
                    `<div style="padding: 8px; font-size: 12px; font-weight: 600; color: var(--daib-text-light); text-align: center;">${keyword}</div>`
                ).join('')}
            `;
            container.appendChild(header);

            // データ行
            departments.forEach(dept => {
                const row = document.createElement('div');
                row.style.cssText = 'display: grid; gap: 2px; margin-bottom: 2px; grid-template-columns: 120px ' + 'repeat(' + keywords.length + ', minmax(100px, 1fr));';
                
                const values = keywords.map(() => (Math.random() * 4 + 1).toFixed(1));
                row.innerHTML = `
                    <div style="padding: 8px; font-size: 12px; font-weight: 500; color: var(--daib-text); display: flex; align-items: center; background: var(--daib-background);">${dept}</div>
                    ${values.map(value => 
                        `<div style="padding: 8px; text-align: center; font-size: 12px; font-weight: 600; ${getHeatmapCellStyle(value)}">${value}</div>`
                    ).join('')}
                `;
                container.appendChild(row);
            });
        }

        // ヒートマップセルのスタイルを取得
        function getHeatmapCellStyle(value) {
            const val = parseFloat(value);
            if (val >= 4.0) return 'background: #059669; color: white;';
            if (val >= 3.5) return 'background: #10b981; color: white;';
            if (val >= 3.0) return 'background: #f59e0b; color: white;';
            if (val >= 2.5) return 'background: #f97316; color: white;';
            return 'background: #dc2626; color: white;';
        }

        // アンケート提出率推移グラフ作成
        function createSubmissionChart() {
            const ctx = document.getElementById('submissionChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['第1回', '第2回', '第3回', '第4回', '第5回', '第6回', '第7回', '第8回', '第9回', '第10回', '第11回', '第12回', '第13回', '第14回', '第15回'],
                    datasets: [{
                        label: 'アンケート提出率 (%)',
                        data: [88, 85, 87, 89, 86, 84, 84, 87, 85, 83, 81, 79, 77, 75, 78],
                        borderColor: '#059669',
                        backgroundColor: 'rgba(5, 150, 105, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 70,
                            max: 95
                        }
                    }
                }
            });
        }

        // アンケート理解度推移グラフ作成
        function createUnderstandingChart() {
            const ctx = document.getElementById('understandingChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['第1回', '第2回', '第3回', '第4回', '第5回', '第6回', '第7回', '第8回', '第9回', '第10回', '第11回', '第12回', '第13回', '第14回', '第15回'],
                    datasets: [{
                        label: 'アンケート理解度 (%)',
                        data: [65, 68, 70, 69, 72, 71, 73.2, 75, 76, 78, 77, 79, 80, 82, 84],
                        borderColor: '#663399',
                        backgroundColor: 'rgba(102, 51, 153, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 60,
                            max: 90
                        }
                    }
                }
            });
        }

        // 個別問題回答率推移グラフ作成
        function createResponseChart() {
            const ctx = document.getElementById('responseChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['第1回', '第2回', '第3回', '第4回', '第5回', '第6回', '第7回', '第8回', '第9回', '第10回', '第11回', '第12回', '第13回', '第14回', '第15回'],
                    datasets: [{
                        label: '個別問題回答率 (%)',
                        data: [78, 75, 77, 79, 81, 80, 82, 84, 83, 85, 87, 86, 88, 90, 89],
                        borderColor: '#0284c7',
                        backgroundColor: 'rgba(2, 132, 199, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 70,
                            max: 95
                        }
                    }
                }
            });
        }

        // 個別問題正答率推移グラフ作成
        function createAccuracyChart() {
            const ctx = document.getElementById('accuracyChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['第1回', '第2回', '第3回', '第4回', '第5回', '第6回', '第7回', '第8回', '第9回', '第10回', '第11回', '第12回', '第13回', '第14回', '第15回'],
                    datasets: [{
                        label: '個別問題正答率 (%)',
                        data: [65, 68, 70, 72, 74, 76, 78, 80, 79, 81, 83, 82, 84, 86, 85],
                        borderColor: '#d97706',
                        backgroundColor: 'rgba(217, 119, 6, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 60,
                            max: 90
                        }
                    }
                }
            });
        }

        // グラフインスタンスを保存する変数
        let predictionModelChart = null;
        let correlationMatrixChart = null;
        let finalCorrelationChartsCreated = false;

        // 最終相関分析タブのグラフ作成
        function createFinalCorrelationCharts() {
            // 既に作成済みの場合は何もしない
            if (finalCorrelationChartsCreated) {
                return;
            }
            // 既存のグラフがあれば削除
            if (predictionModelChart) {
                predictionModelChart.destroy();
                predictionModelChart = null;
            }
            if (correlationMatrixChart) {
                correlationMatrixChart.destroy();
                correlationMatrixChart = null;
            }

            // 相関マトリックスヒートマップ作成
            createCorrelationHeatmap();

            // 成績予測モデルグラフ（実際成績 vs 予測成績）
            const predCtx = document.getElementById('predictionModel').getContext('2d');
            predictionModelChart = new Chart(predCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: '学生データ',
                        data: generatePredictionData(),
                        backgroundColor: 'rgba(102, 51, 153, 0.6)',
                        borderColor: '#663399',
                        pointRadius: 3
                    }, {
                        label: '理想ライン (y=x)',
                        data: [{ x: 0, y: 0 }, { x: 100, y: 100 }],
                        type: 'line',
                        borderColor: '#dc2626',
                        backgroundColor: 'transparent',
                        pointRadius: 0,
                        borderWidth: 2,
                        borderDash: [5, 5]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: '予測成績 (%)'
                            },
                            min: 0,
                            max: 100
                        },
                        y: {
                            title: {
                                display: true,
                                text: '実際成績 (%)'
                            },
                            min: 0,
                            max: 100
                        }
                    }
                }
            });

            // 学生群分析グラフ
            const clusterCtx = document.getElementById('studentClusters').getContext('2d');
            new Chart(clusterCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: '優秀群',
                        data: generateClusterData(70, 90, 300),
                        backgroundColor: 'rgba(5, 150, 105, 0.7)',
                        borderColor: '#059669',
                        pointRadius: 4
                    }, {
                        label: '中程度群',
                        data: generateClusterData(50, 70, 800),
                        backgroundColor: 'rgba(2, 132, 199, 0.7)',
                        borderColor: '#0284c7',
                        pointRadius: 4
                    }, {
                        label: '要注意群',
                        data: generateClusterData(20, 50, 400),
                        backgroundColor: 'rgba(220, 38, 38, 0.7)',
                        borderColor: '#dc2626',
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'アンケート理解度 (%)'
                            },
                            min: 0,
                            max: 100
                        },
                        y: {
                            title: {
                                display: true,
                                text: '期末試験成績 (%)'
                            },
                            min: 0,
                            max: 100
                        }
                    }
                }
            });
            
            // フラグを設定して重複作成を防ぐ
            finalCorrelationChartsCreated = true;
        }

        // 相関マトリックスヒートマップ作成
        function createCorrelationHeatmap() {
            const container = document.getElementById('correlationMatrix').parentElement;
            const labels = ['アンケート提出率', 'アンケート理解度', '個別問題回答率', '個別問題正答率', '期末試験成績'];
            const correlationMatrix = [
                [1.00, 0.82, 0.65, 0.58, 0.76],
                [0.82, 1.00, 0.71, 0.74, 0.89],
                [0.65, 0.71, 1.00, 0.79, 0.68],
                [0.58, 0.74, 0.79, 1.00, 0.83],
                [0.76, 0.89, 0.68, 0.83, 1.00]
            ];
            
            // 既存のヒートマップがあれば削除
            const existingHeatmap = container.querySelector('div[style*="display: inline-block"]');
            if (existingHeatmap) {
                existingHeatmap.remove();
            }
            
            // Canvasを削除してHTMLテーブルでヒートマップ作成
            const canvas = document.getElementById('correlationMatrix');
            canvas.style.display = 'none';
            
            const heatmapHtml = `
                <div style="display: inline-block; border: 1px solid var(--daib-border); border-radius: 8px; overflow: hidden; background: white;">
                    <table style="border-collapse: collapse; font-size: 12px;">
                        <thead>
                            <tr>
                                <th style="padding: 8px; background: var(--daib-surface); border: 1px solid var(--daib-border); font-weight: 600; width: 120px;"></th>
                                ${labels.map(label => `<th style="padding: 8px; background: var(--daib-surface); border: 1px solid var(--daib-border); font-weight: 600; width: 120px; text-align: center; font-size: 11px;">${label}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${correlationMatrix.map((row, i) => `
                                <tr>
                                    <td style="padding: 8px; background: var(--daib-surface); border: 1px solid var(--daib-border); font-weight: 600; font-size: 11px;">${labels[i]}</td>
                                    ${row.map(value => `
                                        <td style="padding: 8px; border: 1px solid var(--daib-border); text-align: center; font-weight: 600; background: ${getCorrelationColor(value)};">
                                            ${value.toFixed(2)}
                                        </td>
                                    `).join('')}
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            container.querySelector('canvas').insertAdjacentHTML('afterend', heatmapHtml);
        }
        
        // 相関係数に応じた色を取得
        function getCorrelationColor(value) {
            if (value >= 0.8) return '#059669'; // 濃い緑（強い正の相関）
            if (value >= 0.6) return '#10b981'; // 緑（中程度の正の相関）
            if (value >= 0.4) return '#84cc16'; // 黄緑（弱い正の相関）
            if (value >= 0.2) return '#f59e0b'; // オレンジ（弱い相関）
            return '#f3f4f6'; // グレー（ほとんど相関なし）
        }

        // 予測モデルデータ生成（実際成績 vs 予測成績）
        function generatePredictionData() {
            // 固定データを使用して毎回同じ結果を表示
            const baseData = [
                {x: 85.2, y: 87.1}, {x: 76.8, y: 73.5}, {x: 92.1, y: 89.3}, {x: 68.4, y: 71.2}, {x: 81.7, y: 78.9},
                {x: 74.9, y: 76.8}, {x: 88.3, y: 91.2}, {x: 65.1, y: 62.7}, {x: 79.6, y: 82.4}, {x: 71.2, y: 69.8},
                {x: 86.7, y: 84.3}, {x: 73.5, y: 75.1}, {x: 90.8, y: 88.6}, {x: 67.9, y: 70.5}, {x: 83.4, y: 81.7},
                {x: 77.1, y: 74.8}, {x: 89.5, y: 92.3}, {x: 66.3, y: 64.9}, {x: 80.7, y: 83.1}, {x: 72.8, y: 71.4},
                {x: 85.9, y: 87.7}, {x: 75.6, y: 73.2}, {x: 91.4, y: 89.8}, {x: 69.7, y: 72.6}, {x: 82.3, y: 79.5},
                {x: 74.2, y: 76.1}, {x: 87.8, y: 90.4}, {x: 65.8, y: 63.5}, {x: 78.9, y: 81.7}, {x: 70.5, y: 68.9},
                {x: 86.1, y: 83.8}, {x: 73.9, y: 75.7}, {x: 90.2, y: 88.1}, {x: 68.6, y: 71.8}, {x: 83.7, y: 80.9},
                {x: 76.4, y: 74.1}, {x: 88.9, y: 91.7}, {x: 66.7, y: 64.2}, {x: 81.2, y: 83.8}, {x: 72.1, y: 70.7},
                {x: 85.6, y: 87.4}, {x: 75.3, y: 72.9}, {x: 91.7, y: 89.1}, {x: 69.4, y: 72.3}, {x: 82.8, y: 79.2},
                {x: 74.5, y: 76.4}, {x: 87.2, y: 90.1}, {x: 65.4, y: 63.8}, {x: 79.3, y: 82.1}, {x: 71.8, y: 69.2}
            ];
            
            // さらに多くのデータポイントを生成するため、基本パターンを繰り返し
            const data = [];
            for (let i = 0; i < 3; i++) {
                baseData.forEach(point => {
                    data.push({
                        x: Math.max(0, Math.min(100, point.x + (i * 2 - 2))), // 少しのバリエーション
                        y: Math.max(0, Math.min(100, point.y + (i * 2 - 2)))
                    });
                });
            }
            return data;
        }

        // クラスターデータ生成
        function generateClusterData(min, max, count) {
            const data = [];
            for (let i = 0; i < count; i++) {
                const x = min + Math.random() * (max - min);
                const y = min + Math.random() * (max - min) + (Math.random() - 0.5) * 10;
                data.push({ x: Math.max(0, Math.min(100, x)), y: Math.max(0, Math.min(100, y)) });
            }
            return data;
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            TEACHER_STATE.updateUI();
            initializeTabs();
            loadDashboardData();
            createSubmissionChart();
            createUnderstandingChart();
            createResponseChart();
            createAccuracyChart();
            
            // タブ切り替え時に最終相関分析グラフを作成
            const finalCorrelationTab = document.querySelector('[data-tab="final-correlation"]');
            if (finalCorrelationTab) {
                finalCorrelationTab.addEventListener('click', function() {
                    setTimeout(() => {
                        createFinalCorrelationCharts();
                    }, 100);
                });
            }
        });
    </script>
</body>
</html>